(function(){var funcTree={},accTree={},exportTree={};var tool={get:function(name){if(true){if(accTree[name]){return accTree[name]}}return funcTree[name]},set:function(name,x){funcTree[name]=x},exp:function(path,x){var paths=path.split(".");var cursor=exportTree;for(var i in paths){if("undefined"==typeof cursor[paths[i]]){if(i==paths.length-1){cursor[paths[i]]=x;break}cursor[paths[i]]={}}cursor=cursor[paths[i]]}},acc:function(name,x){accTree[name]=x}};tool.set("env.isNode",("undefined"!=typeof module&&"undefined"!=typeof process&&"undefined"!=typeof process.title&&"node"===process.title));(function(tool){var alphabet="0123456789abcdefghjkmnpqrtuvwxyz";var alias={o:0,i:1,l:1,s:5};var lookup=function(){var table={};for(var i=0;i<alphabet.length;i++){table[alphabet[i]]=i}for(var key in alias){if(!alias.hasOwnProperty(key)){continue}table[key]=table[""+alias[key]]}lookup=function(){return table};return table};function Encoder(){var skip=0;var bits=0;this.output="";this.readByte=function(_byte){if(skip<0){bits|=(_byte>>(-skip))}else{bits=(_byte<<skip)&248}if(skip>3){skip-=8;return 1}if(skip<4){this.output+=alphabet[bits>>3];skip+=5}return 0};this.finish=function(){var output=this.output+(skip<0?alphabet[bits>>3]:"");this.output="";return output}}Encoder.prototype.update=function(input,flush){for(var i=0;i<input.length;){i+=this.readByte(input[i])}var output=this.output;this.output="";if(flush){output+=this.finish()}return output};function Decoder(){var skip=0;var _byte=0;this.output=[];this.readChar=function(_char){var val=lookup()[_char];if(typeof val=="undefined"){throw Error('Could not find character "'+_char+'" in lookup table.')}val<<=3;_byte|=val>>>skip;skip+=5;if(skip>=8){this.output.push(_byte);skip-=8;if(skip>0){_byte=(val<<(5-skip))&255}else{_byte=0}}};this.finish=function(){if(skip<0){this.output.push(alphabet[bits>>3])}return this.output}}Decoder.prototype.update=function(input,flush){for(var i=0;i<input.length;i++){this.readChar(input[i])}var output=this.output;this.output="";if(flush){output.concat(this.finish())}return output};function encode(input){var encoder=new Encoder();var output=encoder.update(input,true);return output}function decode(input){var decoder=new Decoder();input=input.toLowerCase();var output=decoder.update(input,true);return output}var base32={encode:encode,decode:decode};tool.set("util.encoding.base32",base32)})(tool);(function(tool){function concat(ary){var i,j,count=0,buf;for(i=0;i<ary.length;i++){count+=ary[i].byteLength}var concat=new Uint8Array(count),pointer=0;for(i=0;i<ary.length;i++){buf=new Uint8Array(ary[i]);for(j=0;j<buf.length;j++){concat[pointer]=buf[j];pointer+=1}}return concat.buffer}function xor(a,b){if(a.byteLength!=b.byteLength){throw Error("xor-unequal-length-buffer")}var product=new Uint8Array(a.byteLength),ab=new Uint8Array(a),bb=new Uint8Array(b);for(var i=0;i<product.length;i++){product[i]=ab[i]^bb[i]}return product.buffer}function equal(a,b){try{var x=new Uint8Array(a),y=new Uint8Array(b)}catch(e){return false}if(x.length!=y.length){return false}for(var i=0;i<x.length;i++){if(x[i]!=y[i]){return false}}return true}function reverse(b){var buffer=new Uint8Array(b);var max=buffer.length-1,mid=Math.floor(max/2);var r=max,t;for(var l=0;l<=mid;l++){t=buffer[l];buffer[l]=buffer[r];buffer[r]=t;r-=1}return buffer.buffer}var exporter={concat:concat,xor:xor,equal:equal,reverse:reverse};tool.set("util.buffer",exporter);tool.exp("util.buffer",exporter)})(tool);(function(tool){function enpack(array){var pad=4-array.length%4;if(4==pad){pad=0}for(var i=0;i<pad;i++){array.push(0)}var result=[pad],a1,a2,a3,a4,sigbyte;function bytec(i){if(i<=255){return 0}else{if(i<=65535){return 1}else{if(i<=16777215){return 2}else{if(i<=4294967295){return 3}else{throw Error("uncompressible: "+i)}}}}}function bytex(toArray,i){if(i<=255){toArray.push(i)}else{if(i<=65535){toArray.push((i&65280)>>8,i&255)}else{if(i<=16777215){toArray.push((i&16711680)>>16,(i&65280)>>8,i&255)}else{if(i<=4294967295){toArray.push((i&4278190080)>>24(i&16711680)>>16,(i&65280)>>8,(i&255))}}}}}for(var i=0;i<array.length;i+=4){a1=array[i];a2=array[i+1];a3=array[i+2];a4=array[i+3];sigbyte=(bytec(a1)<<6)+(bytec(a2)<<4)+(bytec(a3)<<2)+(bytec(a4));result.push(sigbyte);bytex(result,a1);bytex(result,a2);bytex(result,a3);bytex(result,a4)}return result}function depack(array){var pad=array[0];if(pad>=4){throw new Error("invalid-input")}var i=1,j;var sigbyte,b1,b2,b3,b4;function bytec(sigbyte,x){return((sigbyte>>(x*2))&3)+1}function bytex(ary,i,j){var ret=0;for(var k=i;k<i+j;k++){ret=(ret<<8);ret|=(ary[k]&255)}return ret}var ret=[];while(i<array.length){sigbyte=array[i];i++;j=bytec(sigbyte,3);b1=bytex(array,i,j);i+=j;j=bytec(sigbyte,2);b2=bytex(array,i,j);i+=j;j=bytec(sigbyte,1);b3=bytex(array,i,j);i+=j;j=bytec(sigbyte,0);b4=bytex(array,i,j);i+=j;ret.push(b1,b2,b3,b4)}return ret.slice(0,ret.length-pad)}function compress(uncompressedBuf){if(!tool.get("util.type")(uncompressedBuf).isArrayBuffer()){throw Error("invalid-input")}var src=new Uint8Array(uncompressedBuf);var i,dictionary={},c,wc,w="",result=[],dictSize=256;for(i=0;i<256;i+=1){dictionary[String.fromCharCode(i)]=i}for(i=0;i<src.length;i+=1){c=String.fromCharCode(src[i]);wc=w+c;if(dictionary.hasOwnProperty(wc)){w=wc}else{result.push(dictionary[w]);dictionary[wc]=dictSize++;w=String(c)}}if(""!==w){result.push(dictionary[w])}return new Uint8Array(enpack(result)).buffer}function decompress(compressedBuf){if(!tool.get("util.type")(compressedBuf).isArrayBuffer()){throw Error("invalid-input")}var src=new Uint8Array(compressedBuf);src=depack(src);var i,dictionary=[],w,result,k,entry="",dictSize=256;for(i=0;i<256;i+=1){dictionary[i]=String.fromCharCode(i)}w=String.fromCharCode(src[0]);result=w;for(i=1;i<src.length;i+=1){k=src[i];if(dictionary[k]){entry=dictionary[k]}else{if(k===dictSize){entry=w+w.charAt(0)}else{return null}}result+=entry;dictionary[dictSize++]=w+entry.charAt(0);w=entry}var ret=new Uint8Array(result.length);for(var i=0;i<ret.length;i++){ret[i]=result.charCodeAt(i)}return ret.buffer}tool.exp("util.compress",compress);tool.exp("util.decompress",decompress);tool.set("util.compress",compress);tool.set("util.decompress",decompress)})(tool);(function(tool){function ArrayBufferToUTF16(src){if(!0==src.byteLength%2){throw new Error("decoding-error")}var src=new Uint16Array(src),i=0,code,low,high,s="";while(i<src.length){code=src[i];if((code>=0&&code<=55295)||(code>=57344&&code<=65535)){s+=String.fromCharCode(code);i+=1}else{if(code>=55296&&code<=56319){high=code;low=src[i+1];i+=2;if(low>=56320&&low<=57343){s+=String.fromCharCode(high)+String.fromCharCode(low)}else{throw new Error("decoding-error")}}else{throw new Error("decoding-error")}}}return s}function encoding(src,format){var self=this;var buffer=null;var tableB64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",tableHEX="0123456789abcdef";var type=tool.get("util.type")(src),base32mod=tool.get("util.encoding.base32");if(type.isArrayBuffer()){buffer=src}else{if(type.isArray()){var copy=new Uint8Array(src.length);for(var i=0;i<copy.length;i++){copy[i]=src[i]&255}buffer=copy.buffer}else{if(type.isString()){if(!format){format=""}switch(format.toLowerCase()){case"hex":if(!/^[0-9a-f]+$/i.test(src)||0!=src.length%2){throw Error("invalid-encoding-choosen")}src=src.toLowerCase();var cbuf=new Uint8Array(src.length/2);for(var i=0;i<cbuf.length;i++){cbuf[i]=tableHEX.indexOf(src[2*i])*16+tableHEX.indexOf(src[2*i+1])}buffer=cbuf.buffer;break;case"base64":if(/(=[^=]+|={3,})$/.test(src)){throw Error("invalid-encoding-choosen")}src=src.replace(/=/g,"");var n=src.length&3;if(1==n){throw Error("invalid-encoding-choosen")}var i=0,j=0,len=Math.ceil(src.length/4);var cbuf=new Uint8Array(len*3);var a,b,c,d;for(i=0;i<len;i++){a=tableB64.indexOf(src[j++]||"A");b=tableB64.indexOf(src[j++]||"A");c=tableB64.indexOf(src[j++]||"A");d=tableB64.indexOf(src[j++]||"A");if((a|b|c|d)<0){throw Error("invalid-encoding-choosen")}cbuf[i*3]=((a<<2)|(b>>4))&255;cbuf[i*3+1]=((b<<4)|(c>>2))&255;cbuf[i*3+2]=((c<<6)|d)&255}buffer=cbuf.buffer.slice(0,cbuf.length+n-4);break;case"base32":if(!/^[0-9a-z=]+$/.test(src)){throw Error("invalid-encoding-choosen")}var ary=base32mod.decode(src);buffer=new Uint8Array(ary).buffer;break;case"ascii":var cbuf=new Uint8Array(src.length);for(var i=0;i<cbuf.length;i++){cbuf[i]=src.charCodeAt(i)&255}buffer=cbuf.buffer;break;default:var cbuf=new Uint16Array(src.length);for(var i=0;i<src.length;i++){cbuf[i]=src.charCodeAt(i)}buffer=cbuf.buffer;break}}else{throw Error("unknown-encoding")}}}this.toArrayBuffer=function(){return buffer};this.toUTF16=function(){return ArrayBufferToUTF16(buffer)};this.toBase64=function(){var view=new Uint8Array(buffer);var i=0,j=0,k=0,len=view.length/3;var b64="";var a,b,c;for(i=0;i<len;++i){a=view[j++];b=view[j++];c=view[j++];b64+=tableB64[a>>2]+tableB64[((a<<4)&63)|(b>>4)]+(isNaN(b)?"=":tableB64[((b<<2)&63)|(c>>6)])+(isNaN(b+c)?"=":tableB64[c&63])}return b64};this.toBase32=function(){var view=new Uint8Array(buffer),ret=base32mod.encode(view);return ret};this.toHEX=function(){var view=new Uint8Array(buffer),s="";for(var i=0;i<view.length;i++){if(view[i]<16){s+="0"+view[i].toString(16)}else{s+=view[i].toString(16)}}return s};this.toASCII=function(){var view=new Uint8Array(buffer),s="";for(var i=0;i<view.length;i++){s+=String.fromCharCode(view[i])}return s};this.toArray=function(){var view=new Uint8Array(buffer),ret=new Array(view.length);for(var i=0;i<ret.length;i++){ret[i]=view[i]}return ret};return this}var exporter=function(a,b){return new encoding(a,b)};tool.set("util.encoding",exporter);tool.exp("util.encoding",exporter)})(tool);(function(tool){var exporter={notice:function(x){console.log(x)},error:function(x){console.error(x)}};tool.set("util.log",exporter);tool.exp("util.log",exporter)})(tool);(function(tool){tool.set("util.srand.getRandomBytes",function(n){var ret=new Uint8Array(n);for(var i=0;i<n;i++){ret[n]=Math.floor(256*Math.random())}return ret});var salsa20CoreX=new Uint32Array(16);function salsa20Core(ina,ret){function R(a,b){return(((a)<<(b))|((a)>>>(32-(b))))}var i;var x=salsa20CoreX;for(i=0;i<16;i++){x[i]=ina[i]}for(i=0;i<32;i++){x[4]^=R(x[0]+x[12],7);x[8]^=R(x[4]+x[0],9);x[12]^=R(x[8]+x[4],13);x[0]^=R(x[12]+x[8],18);x[9]^=R(x[5]+x[1],7);x[13]^=R(x[9]+x[5],9);x[1]^=R(x[13]+x[9],13);x[5]^=R(x[1]+x[13],18);x[14]^=R(x[10]+x[6],7);x[2]^=R(x[14]+x[10],9);x[6]^=R(x[2]+x[14],13);x[10]^=R(x[6]+x[2],18);x[3]^=R(x[15]+x[11],7);x[7]^=R(x[3]+x[15],9);x[11]^=R(x[7]+x[3],13);x[15]^=R(x[11]+x[7],18);x[1]^=R(x[0]+x[3],7);x[2]^=R(x[1]+x[0],9);x[3]^=R(x[2]+x[1],13);x[0]^=R(x[3]+x[2],18);x[6]^=R(x[5]+x[4],7);x[7]^=R(x[6]+x[5],9);x[4]^=R(x[7]+x[6],13);x[5]^=R(x[4]+x[7],18);x[11]^=R(x[10]+x[9],7);x[8]^=R(x[11]+x[10],9);x[9]^=R(x[8]+x[11],13);x[10]^=R(x[9]+x[8],18);x[12]^=R(x[15]+x[14],7);x[13]^=R(x[12]+x[15],9);x[14]^=R(x[13]+x[12],13);x[15]^=R(x[14]+x[13],18)}for(i=0;i<16;i++){ret[i]=x[i]+ina[i]}}var nonce=new Uint8Array(16);function nonceNew(){for(var i=0;i<16;i++){nonce[i]=Math.floor(256*Math.random())}}nonceNew();var counter=new Uint32Array([0,0]);function counterReset(){counter[0]=0;counter[1]=0}function counterInc(){counter[0]+=1;if(0==counter[0]){counter[1]+=1}if(0==counter[1]){nonceNew()}}var randomPool=new Uint8Array(32),randomPoolCursor=0;function randomPoolUpdate(newByte){randomPool[randomPoolCursor]=newByte;randomPoolCursor+=1;if(randomPoolCursor>=32){counterReset();randomPoolCursor=0}}var _initRandomBytes=tool.get("util.srand.getRandomBytes")(32);for(var i=0;i<32;i++){randomPoolUpdate(_initRandomBytes[i])}function feedRandomPoolByTouch(){randomPoolUpdate(new Date().getTime()%256)}setInterval(feedRandomPoolByTouch,100);function getRandomBlock(ret){var sigma=new Uint32Array([1634760805,857760878,2036477234,1797285236]);var input=new Uint32Array(16),nonce2=new Uint32Array(nonce.buffer),key8=new Uint32Array(randomPool.buffer);input[0]=sigma[0];input[1]=key8[0];input[2]=key8[1];input[3]=key8[2];input[4]=key8[3];input[5]=sigma[1];input[6]=nonce2[0];input[7]=nonce2[1];input[8]=counter[0];input[9]=counter[1];input[10]=sigma[2];input[11]=key8[4];input[12]=key8[5];input[13]=key8[6];input[14]=key8[7];input[15]=sigma[3];counterInc();return salsa20Core(input,ret)}function srand(){var self=this;var pool=new Uint32Array(16);this.touch=function(){feedRandomPoolByTouch()};this.bytes=function(count){var max=Math.ceil(count/64);var output=new Uint8Array(count),j=0,k=0,transArray;var mask=tool.get("util.srand.getRandomBytes")(count);for(var i=0;i<max;i++){getRandomBlock(pool);transArray=new Uint8Array(pool.buffer);for(j=0;j<64;j++){if(k>=count){break}output[k]=transArray[j]^mask[k];k+=1}}return output.buffer};this.array=function(count){return new Uint8Array(self.bytes(count))};return this}tool.set("util.srand",srand);tool.exp("util.srand",srand)})(tool);(function(tool){function secureStorage(localStorageInterface){var self=this;var prefix="secureStorage";var mainKeyBuf;function prefix(p){if(!/^[0-9a-z].+$/i.test(prefix)){throw new Error("invalid-prefix")}prefix=p;delete self.prefix}function open(key){var decryptKeyBuf=tool.get("util.encoding")(key).toArrayBuffer();var header=localStorageInterface.getItem(prefix);if(null==header){throw new Error("storage-not-exists")}if(!tool.get("util.type")(header).isString()){var mainKeyEncryptor=tool.get("cipher.symmetric")();mainKeyEncryptor.key(decryptKeyBuf);mainKeyBuf=new tool.get("util.srand")().bytes(128);header=tool.get("util.encoding")(mainKeyEncryptor.encrypt(mainKeyBuf)).toBase64();localStorageInterface.setItem(prefix,header)}else{try{var mainKeyEncryptedBuf=tool.get("util.encoding")(header,"base64").toArrayBuffer();var mainKeyEncryptor=tool.get("cipher.symmetric")();mainKeyEncryptor.key(decryptKeyBuf);mainKeyBuf=mainKeyEncryptor.decrypt(mainKeyEncryptedBuf)}catch(e){throw new Error("storage-corrupted")}}var openRet=_open();if(!openRet){throw new Error("storage-corrupted")}return function close(){openRet._close();_close()}}function changeKey(oldKey,newKey){}function _close(){mainKeyBuf=null;self.open=open;self.changeKey=changeKey;self.prefix=prefix;delete self.setItem;delete self.getItem;delete self.length;delete self.removeItem;delete self.key}function _storageWorker(){var closed=false;var ret={};var symcipher=tool.get("cipher.symmetric")();symcipher.key(mainKeyBuf);var keyList={};function _encryptKey(key){if(undefined!=keyList[key]){return keyList[key]}var ret=symcipher.encrypt(key);ret=prefix+"-"+tool.get("util.encoding")(ret).toBase32();keyList[key]=ret;return ret}function _readKeyList(){var keyName,keyPrefix=prefix+"-",keyEncrypted,trueKeyName;for(var i=0;i<localStorageInterface.length;i++){keyName=localStorageInterface.key(i);if(keyName.slice(0,keyPrefix.length)!=keyPrefix){continue}try{keyEncrypted=keyName.slice(keyPrefix.length);trueKeyName=tool.get("util.encoding")(symcipher.decrypt(tool.get("util.encoding")(keyEncrypted,"base32").toArrayBuffer())).toUTF16()}catch(e){continue}keyList[trueKeyName]=keyName}}_readKeyList();ret.setItem=function(key,value){if(closed){throw new Error("storage-closed")}if(!tool.get("util.type")(key).isString()){throw new Error("invalid-storage-key")}var buf=tool.get("util.encoding")(JSON.stringify(value)).toArrayBuffer();var encryptedBuf=symcipher.encrypt(buf);var encryptedKey=_encryptKey(key);localStorageInterface.setItem(encryptedKey,tool.get("util.encoding")(encryptedBuf).toBase64())};ret.getItem=function(key){if(closed){throw new Error("storage-closed")}if(!tool.get("util.type")(key).isString()){throw new Error("invalid-storage-key")}try{var encryptedKey=_encryptKey(key);var encryptedBufB64=localStorageInterface.getItem(encryptedKey);var encryptedBuf=tool.get("util.encoding")(encryptedBufB64,"base64").toArrayBuffer();var jsonStr=tool.get("util.encoding")(symcipher.decrypt(encryptedBuf)).toUTF16();return JSON.parse(jsonStr)}catch(e){console.log(e);return null}};ret.getLength=function(){};ret._close=function(){closed=true;symcipher=null};return ret}function _open(){try{var workers=new _storageWorker()}catch(e){return false}Object.defineProperty(self,"length",{enumerable:true,configurable:true,writable:false,get:workers.getLength});self.setItem=workers.setItem;self.getItem=workers.getItem;delete self.open;delete self.changeKey;delete self.prefix;return workers._close}_close();return this}})(tool);(function(tool){function type(v){return{isError:function(){return toString.apply(v)==="[object Error]"},isArray:function(){return toString.apply(v)==="[object Array]"},isObject:function(){return !!v&&Object.prototype.toString.call(v)==="[object Object]"},isPrimitive:function(){return self.isString(v)||self.isNumber(v)||self.isBoolean(v)},isFunction:function(){return toString.apply(v)==="[object Function]"},isDate:function(){return toString.apply(v)==="[object Date]"},isNumber:function(){return typeof v==="number"&&isFinite(v)},isString:function(){return typeof v==="string"},isBoolean:function(){return typeof v==="boolean"},isArrayBuffer:function(){return toString.apply(v)==="[object ArrayBuffer]"}}}tool.set("util.type",type);tool.exp("util.type",type)})(tool);(function(tool){tool.exp("util.uuid",function(){var bytes=new tool.get("util.srand")().bytes(16);var hex=tool.get("util.encoding")(bytes).toHEX();return String(hex.slice(0,8)+"-"+hex.slice(8,12)+"-"+hex.slice(12,16)+"-"+hex.slice(16,20)+"-"+hex.slice(20,32))})})(tool);(function(tool){function _array(length){var self=this;var testType=tool.get("util.type");this.pack=function(arrayOfBuffer){if(!Boolean(arrayOfBuffer)){arrayOfBuffer=[]}else{if(arrayOfBuffer.length>255){throw new Error("invalid-parameter")}for(var i=0;i<arrayOfBuffer.length;i++){if(!testType(arrayOfBuffer[i]).isArrayBuffer()){throw new Error("invalid-parameter")}}}var data=[];for(var i in arrayOfBuffer){var len=arrayOfBuffer[i].byteLength;if(1==length){if(len>255){throw new Error("invalid-parameter")}var lenBuf=new Uint8Array([len]).buffer}else{if(2==length){if(len>65535){throw new Error("invalid-parameter")}var lenBuf=new Uint16Array([len]).buffer}}data.push(tool.get("util.buffer").concat([lenBuf,arrayOfBuffer[i]]))}lenBuf=new Uint8Array([arrayOfBuffer.length]).buffer;data.unshift(lenBuf);return tool.get("util.buffer").concat(data)};this.unpack=function(buf){var totalCount=0,cutLen=0,cut;var tempBuf=buf.slice(0,1);buf=buf.slice(1);totalCount=new Uint8Array(tempBuf)[0];var ret=[];for(var i=0;i<totalCount;i++){tempBuf=buf.slice(0,length);buf=buf.slice(length);if(1==length){cutLen=new Uint8Array(tempBuf)[0]}else{if(2==length){cutLen=new Uint16Array(tempBuf)[0]}}cut=buf.slice(0,cutLen);buf=buf.slice(cutLen);ret.push(cut)}return[ret,buf]};return this}tool.set("util.serialize.array",function(regtree){regtree.array=function(){return new _array(2)};regtree.shortArray=function(){return new _array(1)}})})(tool);(function(tool){function _binary(length){var self=this;this.unpack=function(buf){var unpackLength;var headbuf=buf.slice(0,4);if(4==length){unpackLength=new Uint32Array(headbuf)[0];buf=buf.slice(4)}else{if(2==length){unpackLength=new Uint16Array(headbuf)[0];buf=buf.slice(2)}else{if(1==length){unpackLength=new Uint8Array(headbuf)[0];buf=buf.slice(1)}}}if(0==unpackLength){return[null,buf]}unpackResult=buf.slice(0,unpackLength);buf=buf.slice(unpackLength);return[unpackResult,buf]};this.pack=function(buffer){if(!Boolean(buffer)){buffer=new Uint8Array(0).buffer}if(!tool.get("util.type")(buffer).isArrayBuffer()){throw new Error("invalid-parameter")}packLength=buffer.byteLength;if((4==length&&packLength>4294967295)||(2==length&&packLength>65535)||(1==length&&packLength>255)){throw new Error("invalid-parameter")}if(4==length){var head=new Uint32Array(1)}else{if(2==length){var head=new Uint16Array(1)}else{if(1==length){var head=new Uint8Array(1)}}}head[0]=packLength;head=head.buffer;return tool.get("util.buffer").concat([head,buffer])};return this}tool.set("util.serialize.binary",function(regtree){regtree.shortBinary=function(){return new _binary(1)};regtree.binary=function(){return new _binary(2)};regtree.longBinary=function(){return new _binary(4)}})})(tool);(function(tool){function _boolean(){var self=this;this.pack=function(bool){if(!tool.get("util.type")(bool).isBoolean()){throw new Error("invalid-parameter")}var ret=new Uint8Array([(bool?255:0)]).buffer;return ret};this.unpack=function(buf){var value=new Uint8Array(buf.slice(0,1))[0];buf=buf.slice(1);return[Boolean(255==value),buf]};return this}tool.set("util.serialize.boolean",function(regtree){regtree["boolean"]=function(){return new _boolean()}})})(tool);(function(tool){function _constant(p){var self=this;var testType=tool.get("util.type");if(!testType(p).isArray()){throw new Error("invalid-parameter")}var convertString=false;p=p[0];if(testType(p).isString()){p=tool.get("util.encoding")(p).toArrayBuffer();convertString=true}if(!testType(p).isArrayBuffer()){throw new Error("invalid-parameter")}this.pack=function(){return p};this.unpack=function(buf){var value=buf.slice(0,p.byteLength);buf=buf.slice(p.byteLength);if(!tool.get("util.buffer").equal(value,p)){throw new Error("unexpected-constant")}if(convertString){value=tool.get("util.encoding")(value).toUTF16()}return[value,buf]};return this}tool.set("util.serialize.constant",function(regtree){regtree.constant=function(p){return new _constant(p)}})})(tool);(function(tool){function _datetime(){var self=this;var testType=tool.get("util.type");this.pack=function(date){if(!Boolean(date)){return new Uint16Array([0]).buffer}if(!testType(date).isDate()){if(testType(date).isString()){try{date=new Date(date)}catch(e){throw new Error("invalid-parameter")}}else{throw new Error("invalid-parameter")}}var dYear=date.getUTCFullYear()&65535,dMonth=(date.getUTCMonth()+1)&255,dDate=date.getUTCDate()&255,dHour=date.getUTCHours()&255,dMinute=date.getUTCMinutes()&255,dSecond=date.getUTCSeconds()&255;if(0==dYear){throw new Error("invalid-parameter")}var buf=tool.get("util.buffer").concat([new Uint16Array([dYear]).buffer,new Uint8Array([dMonth,dDate,dHour,dMinute,dSecond]).buffer]);return buf};this.unpack=function(buf){var dYear=new Uint16Array(buf.slice(0,2))[0];if(0==dYear){buf=buf.slice(2);return[null,buf]}var dMonth=new Uint8Array(buf.slice(2,3))[0],dDate=new Uint8Array(buf.slice(3,4))[0],dHour=new Uint8Array(buf.slice(4,5))[0],dMinute=new Uint8Array(buf.slice(5,6))[0],dSecond=new Uint8Array(buf.slice(6,7))[0];buf=buf.slice(7);var ret=new Date();ret.setUTCMilliseconds(0);ret.setUTCSeconds(dSecond);ret.setUTCMinutes(dMinute);ret.setUTCHours(dHour);ret.setUTCDate(dDate);ret.setUTCMonth(dMonth);ret.setUTCFullYear(dYear);return[ret,buf]};return this}tool.set("util.serialize.datetime",function(regtree){regtree.datetime=function(){return new _datetime()}})})(tool);(function(tool){function _enum(p){var self=this;if(!tool.get("util.type")(p).isArray()||p.length>255){throw new Error("invalid-parameter")}this.pack=function(str){var value=p.indexOf(str);if(value<0){throw new Error("not-enum-item")}var ret=new Uint8Array([value]);return ret.buffer};this.unpack=function(buf){var value=new Uint8Array(buf.slice(0,1))[0];buf=buf.slice(1);if(value>=p.length){throw new Error("invalid-enum-value")}return[p[value],buf]};return this}tool.set("util.serialize.enum",function(regtree){regtree["enum"]=function(p){return new _enum(p)}})})(tool);(function(tool){var _def=false;function _SERIALIZATION(definition){var self=this;var testType=tool.get("util.type");if(!testType(definition).isObject()){throw new Error("invalid-data-structure")}var order=Object.keys(definition).sort(),workers=[];for(var i in order){var key=order[i];var typeName,typeParam;if(testType(definition[key]).isString()){typeName=definition[key];typeParam=[]}else{typeName=definition[key][0];typeParam=definition[key].slice(1)}if(!_def[typeName]){throw new Error("invalid-data-structure")}workers.push(_def[typeName](typeParam))}this.serialize=function(obj){if(!testType(obj).isObject()){throw new Error("invalid-parameter")}var result=[];for(var i in workers){var key=order[i];result.push(workers[i].pack(obj[key]))}return tool.get("util.buffer").concat(result)};this.deserialize=function(buffer){if(!testType(buffer).isArrayBuffer()){throw new Error("invalid-parameter")}var resultObj={};for(var i in order){var key=order[i];var result=workers[i].unpack(buffer);resultObj[key]=result[0];buffer=result[1]}return resultObj};return this}var exporter=function(definition){if(false===_def){_def={};tool.get("util.serialize.enum")(_def);tool.get("util.serialize.binary")(_def);tool.get("util.serialize.boolean")(_def);tool.get("util.serialize.constant")(_def);tool.get("util.serialize.array")(_def);tool.get("util.serialize.datetime")(_def)}return new _SERIALIZATION(definition)};tool.set("util.serialize",exporter)})(tool);(function(tool){var choosenAlgorithmName="whirlpool";function hash(outputBytesLength){var self=this;var choosenAlgorithm=tool.get("hash.algorithms."+choosenAlgorithmName);var choosenAlgorithmMaxOutput=new choosenAlgorithm().digestSize;if(!outputBytesLength||outputBytesLength>choosenAlgorithmMaxOutput){outputBytesLength=choosenAlgorithmMaxOutput}var algorithmParams={length:outputBytesLength};this.getOutputBytesLength=function(){return outputBytesLength};function _genHashReturn(retArrayBuffer){var sliced=retArrayBuffer.slice(0,outputBytesLength);return{hex:tool.get("util.encoding")(sliced).toHEX(),buffer:sliced}}this.hash=function(dataBuffer){if(!tool.get("util.type")(dataBuffer).isArrayBuffer()){throw Error("invalid-parameter")}var doer=new choosenAlgorithm(algorithmParams);return _genHashReturn(doer.hash(dataBuffer))};this.mac=function(dataBuffer,keyBuffer){if(!(tool.get("util.type")(keyBuffer).isArrayBuffer()&&tool.get("util.type")(dataBuffer).isArrayBuffer())){throw Error("invalid-parameter")}var ret;var doer=new choosenAlgorithm(algorithmParams);if(tool.get("util.type")(doer.mac).isFunction()){ret=doer.mac(dataBuffer,keyBuffer)}else{ret=_HMAC(doer.hash,keyBuffer,dataBuffer,doer.blockSize)}return _genHashReturn(ret)};this.pbkdf2=function(keyBuf,saltBuf,iterations,length){if(!(tool.get("util.type")(keyBuf).isArrayBuffer()&&tool.get("util.type")(saltBuf).isArrayBuffer()&&iterations>0&&length>0)){throw Error("invalid-parameter")}return _PBKDF2(self.mac,new choosenAlgorithm().digestSize,keyBuf,saltBuf,iterations,length)};return this}function _HMAC(hasher,keyBuffer,dataBuffer,blockSizeBytes){if(keyBuffer.byteLength>blockSizeBytes){keyBuffer=new Uint8Array(hasher(keyBuffer))}else{if(keyBuffer.byteLength<blockSizeBytes){var padBuf=new Uint8Array(blockSizeBytes),viewBuf=new Uint8Array(keyBuffer);for(var i=0;i<padBuf.length;i++){if(i<keyBuffer.byteLength){padBuf[i]=viewBuf[i]}else{padBuf[i]=0}}keyBuffer=padBuf}}var o_key_pad=new Uint8Array(blockSizeBytes);var i_key_pad=new Uint8Array(blockSizeBytes);for(var i=0;i<blockSizeBytes;i++){o_key_pad[i]=92^keyBuffer[i];i_key_pad[i]=54^keyBuffer[i]}var innen=tool.get("util.buffer").concat([i_key_pad.buffer,dataBuffer]),hashInnen=hasher(innen);var outer=tool.get("util.buffer").concat([o_key_pad.buffer,hashInnen]),hashOuter=hasher(outer);return hashOuter}function _PBKDF2(macFunc,hashLength,passwordBuffer,saltBuffer,iterations,keylen){var blockCount=Math.ceil(keylen/hashLength);var DKs=new Array(blockCount);for(var i=0;i<blockCount;i++){var Tret=false;var appendix=new Uint32Array([i]);var prevU=tool.get("util.buffer").concat([saltBuffer,appendix.buffer]);for(var j=0;j<iterations;j++){var U=macFunc(passwordBuffer,prevU).buffer;if(false===Tret){Tret=U}else{Tret=tool.get("util.buffer").xor(U,Tret)}prevU=U}DKs[i]=Tret}return tool.get("util.buffer").concat(DKs).slice(0,keylen)}tool.exp("hash",hash);tool.set("hash",hash)})(tool);(function(tool){var WP,R=10,C=[],rc=[],t,x,c,r,i,v1,v2,v4,v5,v8,v9,sbox="\u1823\uc6E8\u87B8\u014F\u36A6\ud2F5\u796F\u9152\u60Bc\u9B8E\uA30c\u7B35\u1dE0\ud7c2\u2E4B\uFE57\u1577\u37E5\u9FF0\u4AdA\u58c9\u290A\uB1A0\u6B85\uBd5d\u10F4\ucB3E\u0567\uE427\u418B\uA77d\u95d8\uFBEE\u7c66\udd17\u479E\ucA2d\uBF07\uAd5A\u8333\u6302\uAA71\uc819\u49d9\uF2E3\u5B88\u9A26\u32B0\uE90F\ud580\uBEcd\u3448\uFF7A\u905F\u2068\u1AAE\uB454\u9322\u64F1\u7312\u4008\uc3Ec\udBA1\u8d3d\u9700\ucF2B\u7682\ud61B\uB5AF\u6A50\u45F3\u30EF\u3F55\uA2EA\u65BA\u2Fc0\udE1c\uFd4d\u9275\u068A\uB2E6\u0E1F\u62d4\uA896\uF9c5\u2559\u8472\u394c\u5E78\u388c\ud1A5\uE261\uB321\u9c1E\u43c7\uFc04\u5199\u6d0d\uFAdF\u7E24\u3BAB\ucE11\u8F4E\uB7EB\u3c81\u94F7\uB913\u2cd3\uE76E\uc403\u5644\u7FA9\u2ABB\uc153\udc0B\u9d6c\u3174\uF646\uAc89\u14E1\u163A\u6909\u70B6\ud0Ed\ucc42\u98A4\u285c\uF886";for(t=8;t-->0;){C[t]=[]}for(x=0;x<256;x++){c=sbox.charCodeAt(x/2);v1=((x&1)==0)?c>>>8:c&255;v2=v1<<1;if(v2>=256){v2^=285}v4=v2<<1;if(v4>=256){v4^=285}v5=v4^v1;v8=v4<<1;if(v8>=256){v8^=285}v9=v8^v1;C[0][x]=[0,0];C[0][x][0]=(v1<<24)|(v1<<16)|(v4<<8)|(v1);C[0][x][1]=(v8<<24)|(v5<<16)|(v2<<8)|(v9);for(var t=1;t<8;t++){C[t][x]=[0,0];C[t][x][0]=(C[t-1][x][0]>>>8)|((C[t-1][x][1]<<24));C[t][x][1]=(C[t-1][x][1]>>>8)|((C[t-1][x][0]<<24))}}rc[0]=[0,0];for(r=1;r<=R;r++){i=8*(r-1);rc[r]=[0,0];rc[r][0]=(C[0][i][0]&4278190080)^(C[1][i+1][0]&16711680)^(C[2][i+2][0]&65280)^(C[3][i+3][0]&255);rc[r][1]=(C[4][i+4][1]&4278190080)^(C[5][i+5][1]&16711680)^(C[6][i+6][1]&65280)^(C[7][i+7][1]&255)}var bitLength=[],buffer=[],bufferBits=0,bufferPos=0,hash=[],K=[],L=[],block=[],state=[];var processBuffer=function(){var i,j,r,s,t;for(i=0,j=0;i<8;i++,j+=8){block[i]=[0,0];block[i][0]=((buffer[j]&255)<<24)^((buffer[j+1]&255)<<16)^((buffer[j+2]&255)<<8)^((buffer[j+3]&255));block[i][1]=((buffer[j+4]&255)<<24)^((buffer[j+5]&255)<<16)^((buffer[j+6]&255)<<8)^((buffer[j+7]&255))}for(i=0;i<8;i++){state[i]=[0,0];K[i]=[0,0];state[i][0]=block[i][0]^(K[i][0]=hash[i][0]);state[i][1]=block[i][1]^(K[i][1]=hash[i][1])}for(r=1;r<=R;r++){for(i=0;i<8;i++){L[i]=[0,0];for(t=0,s=56,j=0;t<8;t++,s-=8,j=s<32?1:0){L[i][0]^=C[t][(K[(i-t)&7][j]>>>(s%32))&255][0];L[i][1]^=C[t][(K[(i-t)&7][j]>>>(s%32))&255][1]}}for(i=0;i<8;i++){K[i][0]=L[i][0];K[i][1]=L[i][1]}K[0][0]^=rc[r][0];K[0][1]^=rc[r][1];for(i=0;i<8;i++){L[i][0]=K[i][0];L[i][1]=K[i][1];for(t=0,s=56,j=0;t<8;t++,s-=8,j=s<32?1:0){L[i][0]^=C[t][(state[(i-t)&7][j]>>>(s%32))&255][0];L[i][1]^=C[t][(state[(i-t)&7][j]>>>(s%32))&255][1]}}for(i=0;i<8;i++){state[i][0]=L[i][0];state[i][1]=L[i][1]}}for(i=0;i<8;i++){hash[i][0]^=state[i][0]^block[i][0];hash[i][1]^=state[i][1]^block[i][1]}};WP=Whirlpool=function(str){return WP.init().add(str).finalize()};WP.version="3.0";WP.init=function(){for(var i=32;i-->0;){bitLength[i]=0}bufferBits=bufferPos=0;buffer=[0];for(i=8;i-->0;){hash[i]=[0,0]}return WP};WP.add=function(sourceBuf){if(!sourceBuf){return WP}var source=new Uint8Array(sourceBuf);var sourceBits=source.length*8;var sourcePos=0,sourceGap=(8-(sourceBits&7))&7,bufferRem=bufferBits&7,i,b,carry,value=sourceBits;for(i=31,carry=0;i>=0;i--){carry+=(bitLength[i]&255)+(value%256);bitLength[i]=carry&255;carry>>>=8;value=Math.floor(value/256)}while(sourceBits>8){b=((source[sourcePos]<<sourceGap)&255)|((source[sourcePos+1]&255)>>>(8-sourceGap));if(b<0||b>=256){return"Whirlpool requires a byte array"}buffer[bufferPos++]|=b>>>bufferRem;bufferBits+=8-bufferRem;if(bufferBits==512){processBuffer();bufferBits=bufferPos=0;buffer=[]}buffer[bufferPos]=((b<<(8-bufferRem))&255);bufferBits+=bufferRem;sourceBits-=8;sourcePos++}if(sourceBits>0){b=(source[sourcePos]<<sourceGap)&255;buffer[bufferPos]|=b>>>bufferRem}else{b=0}if(bufferRem+sourceBits<8){bufferBits+=sourceBits}else{bufferPos++;bufferBits+=8-bufferRem;sourceBits-=8-bufferRem;if(bufferBits==512){processBuffer();bufferBits=bufferPos=0;buffer=[]}buffer[bufferPos]=((b<<(8-bufferRem))&255);bufferBits+=sourceBits}return WP};WP.finalize=function(){var i,j,h,str="",digest=[];buffer[bufferPos]|=128>>>(bufferBits&7);bufferPos++;if(bufferPos>32){while(bufferPos<64){buffer[bufferPos++]=0}processBuffer();bufferPos=0;buffer=[]}while(bufferPos<32){buffer[bufferPos++]=0}buffer.push.apply(buffer,bitLength);processBuffer();for(i=0,j=0;i<8;i++,j+=8){h=hash[i][0];digest[j]=h>>>24&255;digest[j+1]=h>>>16&255;digest[j+2]=h>>>8&255;digest[j+3]=h&255;h=hash[i][1];digest[j+4]=h>>>24&255;digest[j+5]=h>>>16&255;digest[j+6]=h>>>8&255;digest[j+7]=h&255}return new Uint8Array(digest).buffer};function hashFunctionInterface(){var self=this;this.name="WHIRLPOOL";this.blockSize=64;this.digestSize=64;this.hash=function(dataBuf){return Whirlpool(dataBuf)};return this}tool.set("hash.algorithms.whirlpool",hashFunctionInterface)})(tool);(function(tool){var dbits;var canary=244837814094590;var j_lm=((canary&16777215)==15715070);function BigInteger(a,b,c){if(!(this instanceof BigInteger)){return new BigInteger(a,b,c)}if(a!=null){if("number"==typeof a){this.fromNumber(a,b,c)}else{if(b==null&&"string"!=typeof a){this.fromString(a,256)}else{this.fromString(a,b)}}}}var proto=BigInteger.prototype;function nbi(){return new BigInteger(null)}function am1(i,x,w,j,c,n){while(--n>=0){var v=x*this[i++]+w[j]+c;c=Math.floor(v/67108864);w[j++]=v&67108863}return c}function am2(i,x,w,j,c,n){var xl=x&32767,xh=x>>15;while(--n>=0){var l=this[i]&32767;var h=this[i++]>>15;var m=xh*l+h*xl;l=xl*l+((m&32767)<<15)+w[j]+(c&1073741823);c=(l>>>30)+(m>>>15)+xh*h+(c>>>30);w[j++]=l&1073741823}return c}function am3(i,x,w,j,c,n){var xl=x&16383,xh=x>>14;while(--n>=0){var l=this[i]&16383;var h=this[i++]>>14;var m=xh*l+h*xl;l=xl*l+((m&16383)<<14)+w[j]+c;c=(l>>28)+(m>>14)+xh*h;w[j++]=l&268435455}return c}BigInteger.prototype.am=am1;dbits=26;BigInteger.prototype.DB=dbits;BigInteger.prototype.DM=((1<<dbits)-1);var DV=BigInteger.prototype.DV=(1<<dbits);var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP);BigInteger.prototype.F1=BI_FP-dbits;BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz";var BI_RC=new Array();var rr,vv;rr="0".charCodeAt(0);for(vv=0;vv<=9;++vv){BI_RC[rr++]=vv}rr="a".charCodeAt(0);for(vv=10;vv<36;++vv){BI_RC[rr++]=vv}rr="A".charCodeAt(0);for(vv=10;vv<36;++vv){BI_RC[rr++]=vv}function int2char(n){return BI_RM.charAt(n)}function intAt(s,i){var c=BI_RC[s.charCodeAt(i)];return(c==null)?-1:c}function bnpCopyTo(r){for(var i=this.t-1;i>=0;--i){r[i]=this[i]}r.t=this.t;r.s=this.s}function bnpFromInt(x){this.t=1;this.s=(x<0)?-1:0;if(x>0){this[0]=x}else{if(x<-1){this[0]=x+DV}else{this.t=0}}}function nbv(i){var r=nbi();r.fromInt(i);return r}function bnpFromString(s,b){var self=this;var k;if(b==16){k=4}else{if(b==8){k=3}else{if(b==256){k=8}else{if(b==2){k=1}else{if(b==32){k=5}else{if(b==4){k=2}else{self.fromRadix(s,b);return}}}}}}self.t=0;self.s=0;var i=s.length,mi=false,sh=0;while(--i>=0){var x=(k==8)?s[i]&255:intAt(s,i);if(x<0){if(s.charAt(i)=="-"){mi=true}continue}mi=false;if(sh==0){self[self.t++]=x}else{if(sh+k>self.DB){self[self.t-1]|=(x&((1<<(self.DB-sh))-1))<<sh;self[self.t++]=(x>>(self.DB-sh))}else{self[self.t-1]|=x<<sh}}sh+=k;if(sh>=self.DB){sh-=self.DB}}if(k==8&&(s[0]&128)!=0){self.s=-1;if(sh>0){self[self.t-1]|=((1<<(self.DB-sh))-1)<<sh}}self.clamp();if(mi){BigInteger.ZERO.subTo(self,self)}}function bnpClamp(){var c=this.s&this.DM;while(this.t>0&&this[this.t-1]==c){--this.t}}function bnToString(b){var self=this;if(self.s<0){return"-"+self.negate().toString(b)}var k;if(b==16){k=4}else{if(b==8){k=3}else{if(b==2){k=1}else{if(b==32){k=5}else{if(b==4){k=2}else{return self.toRadix(b)}}}}}var km=(1<<k)-1,d,m=false,r="",i=self.t;var p=self.DB-(i*self.DB)%k;if(i-->0){if(p<self.DB&&(d=self[i]>>p)>0){m=true;r=int2char(d)}while(i>=0){if(p<k){d=(self[i]&((1<<p)-1))<<(k-p);d|=self[--i]>>(p+=self.DB-k)}else{d=(self[i]>>(p-=k))&km;if(p<=0){p+=self.DB;--i}}if(d>0){m=true}if(m){r+=int2char(d)}}}return m?r:"0"}function bnNegate(){var r=nbi();BigInteger.ZERO.subTo(this,r);return r}function bnAbs(){return(this.s<0)?this.negate():this}function bnCompareTo(a){var r=this.s-a.s;if(r!=0){return r}var i=this.t;r=i-a.t;if(r!=0){return(this.s<0)?-r:r}while(--i>=0){if((r=this[i]-a[i])!=0){return r}}return 0}function nbits(x){var r=1,t;if((t=x>>>16)!=0){x=t;r+=16}if((t=x>>8)!=0){x=t;r+=8}if((t=x>>4)!=0){x=t;r+=4}if((t=x>>2)!=0){x=t;r+=2}if((t=x>>1)!=0){x=t;r+=1}return r}function bnBitLength(){if(this.t<=0){return 0}return this.DB*(this.t-1)+nbits(this[this.t-1]^(this.s&this.DM))}function bnpDLShiftTo(n,r){var i;for(i=this.t-1;i>=0;--i){r[i+n]=this[i]}for(i=n-1;i>=0;--i){r[i]=0}r.t=this.t+n;r.s=this.s}function bnpDRShiftTo(n,r){for(var i=n;i<this.t;++i){r[i-n]=this[i]}r.t=Math.max(this.t-n,0);r.s=this.s}function bnpLShiftTo(n,r){var self=this;var bs=n%self.DB;var cbs=self.DB-bs;var bm=(1<<cbs)-1;var ds=Math.floor(n/self.DB),c=(self.s<<bs)&self.DM,i;for(i=self.t-1;i>=0;--i){r[i+ds+1]=(self[i]>>cbs)|c;c=(self[i]&bm)<<bs}for(i=ds-1;i>=0;--i){r[i]=0}r[ds]=c;r.t=self.t+ds+1;r.s=self.s;r.clamp()}function bnpRShiftTo(n,r){var self=this;r.s=self.s;var ds=Math.floor(n/self.DB);if(ds>=self.t){r.t=0;return}var bs=n%self.DB;var cbs=self.DB-bs;var bm=(1<<bs)-1;r[0]=self[ds]>>bs;for(var i=ds+1;i<self.t;++i){r[i-ds-1]|=(self[i]&bm)<<cbs;r[i-ds]=self[i]>>bs}if(bs>0){r[self.t-ds-1]|=(self.s&bm)<<cbs}r.t=self.t-ds;r.clamp()}function bnpSubTo(a,r){var self=this;var i=0,c=0,m=Math.min(a.t,self.t);while(i<m){c+=self[i]-a[i];r[i++]=c&self.DM;c>>=self.DB}if(a.t<self.t){c-=a.s;while(i<self.t){c+=self[i];r[i++]=c&self.DM;c>>=self.DB}c+=self.s}else{c+=self.s;while(i<a.t){c-=a[i];r[i++]=c&self.DM;c>>=self.DB}c-=a.s}r.s=(c<0)?-1:0;if(c<-1){r[i++]=self.DV+c}else{if(c>0){r[i++]=c}}r.t=i;r.clamp()}function bnpMultiplyTo(a,r){var x=this.abs(),y=a.abs();var i=x.t;r.t=i+y.t;while(--i>=0){r[i]=0}for(i=0;i<y.t;++i){r[i+x.t]=x.am(0,y[i],r,i,0,x.t)}r.s=0;r.clamp();if(this.s!=a.s){BigInteger.ZERO.subTo(r,r)}}function bnpSquareTo(r){var x=this.abs();var i=r.t=2*x.t;while(--i>=0){r[i]=0}for(i=0;i<x.t-1;++i){var c=x.am(i,x[i],r,2*i,0,1);if((r[i+x.t]+=x.am(i+1,2*x[i],r,2*i+1,c,x.t-i-1))>=x.DV){r[i+x.t]-=x.DV;r[i+x.t+1]=1}}if(r.t>0){r[r.t-1]+=x.am(i,x[i],r,2*i,0,1)}r.s=0;r.clamp()}function bnpDivRemTo(m,q,r){var self=this;var pm=m.abs();if(pm.t<=0){return}var pt=self.abs();if(pt.t<pm.t){if(q!=null){q.fromInt(0)}if(r!=null){self.copyTo(r)}return}if(r==null){r=nbi()}var y=nbi(),ts=self.s,ms=m.s;var nsh=self.DB-nbits(pm[pm.t-1]);if(nsh>0){pm.lShiftTo(nsh,y);pt.lShiftTo(nsh,r)}else{pm.copyTo(y);pt.copyTo(r)}var ys=y.t;var y0=y[ys-1];if(y0==0){return}var yt=y0*(1<<self.F1)+((ys>1)?y[ys-2]>>self.F2:0);var d1=self.FV/yt,d2=(1<<self.F1)/yt,e=1<<self.F2;var i=r.t,j=i-ys,t=(q==null)?nbi():q;y.dlShiftTo(j,t);if(r.compareTo(t)>=0){r[r.t++]=1;r.subTo(t,r)}BigInteger.ONE.dlShiftTo(ys,t);t.subTo(y,y);while(y.t<ys){y[y.t++]=0}while(--j>=0){var qd=(r[--i]==y0)?self.DM:Math.floor(r[i]*d1+(r[i-1]+e)*d2);if((r[i]+=y.am(0,qd,r,j,0,ys))<qd){y.dlShiftTo(j,t);r.subTo(t,r);while(r[i]<--qd){r.subTo(t,r)}}}if(q!=null){r.drShiftTo(ys,q);if(ts!=ms){BigInteger.ZERO.subTo(q,q)}}r.t=ys;r.clamp();if(nsh>0){r.rShiftTo(nsh,r)}if(ts<0){BigInteger.ZERO.subTo(r,r)}}function bnMod(a){var r=nbi();this.abs().divRemTo(a,null,r);if(this.s<0&&r.compareTo(BigInteger.ZERO)>0){a.subTo(r,r)}return r}function Classic(m){this.m=m}function cConvert(x){if(x.s<0||x.compareTo(this.m)>=0){return x.mod(this.m)}else{return x}}function cRevert(x){return x}function cReduce(x){x.divRemTo(this.m,null,x)}function cMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}function cSqrTo(x,r){x.squareTo(r);this.reduce(r)}Classic.prototype.convert=cConvert;Classic.prototype.revert=cRevert;Classic.prototype.reduce=cReduce;Classic.prototype.mulTo=cMulTo;Classic.prototype.sqrTo=cSqrTo;function bnpInvDigit(){if(this.t<1){return 0}var x=this[0];if((x&1)==0){return 0}var y=x&3;y=(y*(2-(x&15)*y))&15;y=(y*(2-(x&255)*y))&255;y=(y*(2-(((x&65535)*y)&65535)))&65535;y=(y*(2-x*y%this.DV))%this.DV;return(y>0)?this.DV-y:-y}function Montgomery(m){this.m=m;this.mp=m.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<(m.DB-15))-1;this.mt2=2*m.t}function montConvert(x){var r=nbi();x.abs().dlShiftTo(this.m.t,r);r.divRemTo(this.m,null,r);if(x.s<0&&r.compareTo(BigInteger.ZERO)>0){this.m.subTo(r,r)}return r}function montRevert(x){var r=nbi();x.copyTo(r);this.reduce(r);return r}function montReduce(x){while(x.t<=this.mt2){x[x.t++]=0}for(var i=0;i<this.m.t;++i){var j=x[i]&32767;var u0=(j*this.mpl+(((j*this.mph+(x[i]>>15)*this.mpl)&this.um)<<15))&x.DM;j=i+this.m.t;x[j]+=this.m.am(0,u0,x,i,0,this.m.t);while(x[j]>=x.DV){x[j]-=x.DV;x[++j]++}}x.clamp();x.drShiftTo(this.m.t,x);if(x.compareTo(this.m)>=0){x.subTo(this.m,x)}}function montSqrTo(x,r){x.squareTo(r);this.reduce(r)}function montMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}Montgomery.prototype.convert=montConvert;Montgomery.prototype.revert=montRevert;Montgomery.prototype.reduce=montReduce;Montgomery.prototype.mulTo=montMulTo;Montgomery.prototype.sqrTo=montSqrTo;function bnpIsEven(){return((this.t>0)?(this[0]&1):this.s)==0}function bnpExp(e,z){if(e>4294967295||e<1){return BigInteger.ONE}var r=nbi(),r2=nbi(),g=z.convert(this),i=nbits(e)-1;g.copyTo(r);while(--i>=0){z.sqrTo(r,r2);if((e&(1<<i))>0){z.mulTo(r2,g,r)}else{var t=r;r=r2;r2=t}}return z.revert(r)}function bnModPowInt(e,m){var z;if(e<256||m.isEven()){z=new Classic(m)}else{z=new Montgomery(m)}return this.exp(e,z)}proto.copyTo=bnpCopyTo;proto.fromInt=bnpFromInt;proto.fromString=bnpFromString;proto.clamp=bnpClamp;proto.dlShiftTo=bnpDLShiftTo;proto.drShiftTo=bnpDRShiftTo;proto.lShiftTo=bnpLShiftTo;proto.rShiftTo=bnpRShiftTo;proto.subTo=bnpSubTo;proto.multiplyTo=bnpMultiplyTo;proto.squareTo=bnpSquareTo;proto.divRemTo=bnpDivRemTo;proto.invDigit=bnpInvDigit;proto.isEven=bnpIsEven;proto.exp=bnpExp;proto.toString=bnToString;proto.negate=bnNegate;proto.abs=bnAbs;proto.compareTo=bnCompareTo;proto.bitLength=bnBitLength;proto.mod=bnMod;proto.modPowInt=bnModPowInt;function nbi(){return new BigInteger(null)}function bnClone(){var r=nbi();this.copyTo(r);return r}function bnIntValue(){if(this.s<0){if(this.t==1){return this[0]-this.DV}else{if(this.t==0){return -1}}}else{if(this.t==1){return this[0]}else{if(this.t==0){return 0}}}return((this[1]&((1<<(32-this.DB))-1))<<this.DB)|this[0]}function bnByteValue(){return(this.t==0)?this.s:(this[0]<<24)>>24}function bnShortValue(){return(this.t==0)?this.s:(this[0]<<16)>>16}function bnpChunkSize(r){return Math.floor(Math.LN2*this.DB/Math.log(r))}function bnSigNum(){if(this.s<0){return -1}else{if(this.t<=0||(this.t==1&&this[0]<=0)){return 0}else{return 1}}}function bnpToRadix(b){if(b==null){b=10}if(this.signum()==0||b<2||b>36){return"0"}var cs=this.chunkSize(b);var a=Math.pow(b,cs);var d=nbv(a),y=nbi(),z=nbi(),r="";this.divRemTo(d,y,z);while(y.signum()>0){r=(a+z.intValue()).toString(b).substr(1)+r;y.divRemTo(d,y,z)}return z.intValue().toString(b)+r}function bnpFromRadix(s,b){var self=this;self.fromInt(0);if(b==null){b=10}var cs=self.chunkSize(b);var d=Math.pow(b,cs),mi=false,j=0,w=0;for(var i=0;i<s.length;++i){var x=intAt(s,i);if(x<0){if(s.charAt(i)=="-"&&self.signum()==0){mi=true}continue}w=b*w+x;if(++j>=cs){self.dMultiply(d);self.dAddOffset(w,0);j=0;w=0}}if(j>0){self.dMultiply(Math.pow(b,j));self.dAddOffset(w,0)}if(mi){BigInteger.ZERO.subTo(self,self)}}function bnpFromNumber(a,b,c){var self=this;if("number"==typeof b){if(a<2){self.fromInt(1)}else{self.fromNumber(a,c);if(!self.testBit(a-1)){self.bitwiseTo(BigInteger.ONE.shiftLeft(a-1),op_or,self)}if(self.isEven()){self.dAddOffset(1,0)}while(!self.isProbablePrime(b)){self.dAddOffset(2,0);if(self.bitLength()>a){self.subTo(BigInteger.ONE.shiftLeft(a-1),self)}}}}else{var x=new Array(),t=a&7;x.length=(a>>3)+1;b.nextBytes(x);if(t>0){x[0]&=((1<<t)-1)}else{x[0]=0}self.fromString(x,256)}}function bnToByteArray(){var self=this;var i=self.t,r=new Array();r[0]=self.s;var p=self.DB-(i*self.DB)%8,d,k=0;if(i-->0){if(p<self.DB&&(d=self[i]>>p)!=(self.s&self.DM)>>p){r[k++]=d|(self.s<<(self.DB-p))}while(i>=0){if(p<8){d=(self[i]&((1<<p)-1))<<(8-p);d|=self[--i]>>(p+=self.DB-8)}else{d=(self[i]>>(p-=8))&255;if(p<=0){p+=self.DB;--i}}if((d&128)!=0){d|=-256}if(k===0&&(self.s&128)!=(d&128)){++k}if(k>0||d!=self.s){r[k++]=d}}}return r}function bnEquals(a){return(this.compareTo(a)==0)}function bnMin(a){return(this.compareTo(a)<0)?this:a}function bnMax(a){return(this.compareTo(a)>0)?this:a}function bnpBitwiseTo(a,op,r){var self=this;var i,f,m=Math.min(a.t,self.t);for(i=0;i<m;++i){r[i]=op(self[i],a[i])}if(a.t<self.t){f=a.s&self.DM;for(i=m;i<self.t;++i){r[i]=op(self[i],f)}r.t=self.t}else{f=self.s&self.DM;for(i=m;i<a.t;++i){r[i]=op(f,a[i])}r.t=a.t}r.s=op(self.s,a.s);r.clamp()}function op_and(x,y){return x&y}function bnAnd(a){var r=nbi();this.bitwiseTo(a,op_and,r);return r}function op_or(x,y){return x|y}function bnOr(a){var r=nbi();this.bitwiseTo(a,op_or,r);return r}function op_xor(x,y){return x^y}function bnXor(a){var r=nbi();this.bitwiseTo(a,op_xor,r);return r}function op_andnot(x,y){return x&~y}function bnAndNot(a){var r=nbi();this.bitwiseTo(a,op_andnot,r);return r}function bnNot(){var r=nbi();for(var i=0;i<this.t;++i){r[i]=this.DM&~this[i]}r.t=this.t;r.s=~this.s;return r}function bnShiftLeft(n){var r=nbi();if(n<0){this.rShiftTo(-n,r)}else{this.lShiftTo(n,r)}return r}function bnShiftRight(n){var r=nbi();if(n<0){this.lShiftTo(-n,r)}else{this.rShiftTo(n,r)}return r}function lbit(x){if(x==0){return -1}var r=0;if((x&65535)==0){x>>=16;r+=16}if((x&255)==0){x>>=8;r+=8}if((x&15)==0){x>>=4;r+=4}if((x&3)==0){x>>=2;r+=2}if((x&1)==0){++r}return r}function bnGetLowestSetBit(){for(var i=0;i<this.t;++i){if(this[i]!=0){return i*this.DB+lbit(this[i])}}if(this.s<0){return this.t*this.DB}return -1}function cbit(x){var r=0;while(x!=0){x&=x-1;++r}return r}function bnBitCount(){var r=0,x=this.s&this.DM;for(var i=0;i<this.t;++i){r+=cbit(this[i]^x)}return r}function bnTestBit(n){var j=Math.floor(n/this.DB);if(j>=this.t){return(this.s!=0)}return((this[j]&(1<<(n%this.DB)))!=0)}function bnpChangeBit(n,op){var r=BigInteger.ONE.shiftLeft(n);this.bitwiseTo(r,op,r);return r}function bnSetBit(n){return this.changeBit(n,op_or)}function bnClearBit(n){return this.changeBit(n,op_andnot)}function bnFlipBit(n){return this.changeBit(n,op_xor)}function bnpAddTo(a,r){var self=this;var i=0,c=0,m=Math.min(a.t,self.t);while(i<m){c+=self[i]+a[i];r[i++]=c&self.DM;c>>=self.DB}if(a.t<self.t){c+=a.s;while(i<self.t){c+=self[i];r[i++]=c&self.DM;c>>=self.DB}c+=self.s}else{c+=self.s;while(i<a.t){c+=a[i];r[i++]=c&self.DM;c>>=self.DB}c+=a.s}r.s=(c<0)?-1:0;if(c>0){r[i++]=c}else{if(c<-1){r[i++]=self.DV+c}}r.t=i;r.clamp()}function bnAdd(a){var r=nbi();this.addTo(a,r);return r}function bnSubtract(a){var r=nbi();this.subTo(a,r);return r}function bnMultiply(a){var r=nbi();this.multiplyTo(a,r);return r}function bnSquare(){var r=nbi();this.squareTo(r);return r}function bnDivide(a){var r=nbi();this.divRemTo(a,r,null);return r}function bnRemainder(a){var r=nbi();this.divRemTo(a,null,r);return r}function bnDivideAndRemainder(a){var q=nbi(),r=nbi();this.divRemTo(a,q,r);return new Array(q,r)}function bnpDMultiply(n){this[this.t]=this.am(0,n-1,this,0,0,this.t);++this.t;this.clamp()}function bnpDAddOffset(n,w){if(n==0){return}while(this.t<=w){this[this.t++]=0}this[w]+=n;while(this[w]>=this.DV){this[w]-=this.DV;if(++w>=this.t){this[this.t++]=0}++this[w]}}function NullExp(){}function nNop(x){return x}function nMulTo(x,y,r){x.multiplyTo(y,r)}function nSqrTo(x,r){x.squareTo(r)}NullExp.prototype.convert=nNop;NullExp.prototype.revert=nNop;NullExp.prototype.mulTo=nMulTo;NullExp.prototype.sqrTo=nSqrTo;function bnPow(e){return this.exp(e,new NullExp())}function bnpMultiplyLowerTo(a,n,r){var i=Math.min(this.t+a.t,n);r.s=0;r.t=i;while(i>0){r[--i]=0}var j;for(j=r.t-this.t;i<j;++i){r[i+this.t]=this.am(0,a[i],r,i,0,this.t)}for(j=Math.min(a.t,n);i<j;++i){this.am(0,a[i],r,i,0,n-i)}r.clamp()}function bnpMultiplyUpperTo(a,n,r){--n;var i=r.t=this.t+a.t-n;r.s=0;while(--i>=0){r[i]=0}for(i=Math.max(n-this.t,0);i<a.t;++i){r[this.t+i-n]=this.am(n-i,a[i],r,0,0,this.t+i-n)}r.clamp();r.drShiftTo(1,r)}function Barrett(m){this.r2=nbi();this.q3=nbi();BigInteger.ONE.dlShiftTo(2*m.t,this.r2);this.mu=this.r2.divide(m);this.m=m}function barrettConvert(x){if(x.s<0||x.t>2*this.m.t){return x.mod(this.m)}else{if(x.compareTo(this.m)<0){return x}else{var r=nbi();x.copyTo(r);this.reduce(r);return r}}}function barrettRevert(x){return x}function barrettReduce(x){var self=this;x.drShiftTo(self.m.t-1,self.r2);if(x.t>self.m.t+1){x.t=self.m.t+1;x.clamp()}self.mu.multiplyUpperTo(self.r2,self.m.t+1,self.q3);self.m.multiplyLowerTo(self.q3,self.m.t+1,self.r2);while(x.compareTo(self.r2)<0){x.dAddOffset(1,self.m.t+1)}x.subTo(self.r2,x);while(x.compareTo(self.m)>=0){x.subTo(self.m,x)}}function barrettSqrTo(x,r){x.squareTo(r);this.reduce(r)}function barrettMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}Barrett.prototype.convert=barrettConvert;Barrett.prototype.revert=barrettRevert;Barrett.prototype.reduce=barrettReduce;Barrett.prototype.mulTo=barrettMulTo;Barrett.prototype.sqrTo=barrettSqrTo;function bnModPow(e,m){var i=e.bitLength(),k,r=nbv(1),z;if(i<=0){return r}else{if(i<18){k=1}else{if(i<48){k=3}else{if(i<144){k=4}else{if(i<768){k=5}else{k=6}}}}}if(i<8){z=new Classic(m)}else{if(m.isEven()){z=new Barrett(m)}else{z=new Montgomery(m)}}var g=new Array(),n=3,k1=k-1,km=(1<<k)-1;g[1]=z.convert(this);if(k>1){var g2=nbi();z.sqrTo(g[1],g2);while(n<=km){g[n]=nbi();z.mulTo(g2,g[n-2],g[n]);n+=2}}var j=e.t-1,w,is1=true,r2=nbi(),t;i=nbits(e[j])-1;while(j>=0){if(i>=k1){w=(e[j]>>(i-k1))&km}else{w=(e[j]&((1<<(i+1))-1))<<(k1-i);if(j>0){w|=e[j-1]>>(this.DB+i-k1)}}n=k;while((w&1)==0){w>>=1;--n}if((i-=n)<0){i+=this.DB;--j}if(is1){g[w].copyTo(r);is1=false}else{while(n>1){z.sqrTo(r,r2);z.sqrTo(r2,r);n-=2}if(n>0){z.sqrTo(r,r2)}else{t=r;r=r2;r2=t}z.mulTo(r2,g[w],r)}while(j>=0&&(e[j]&(1<<i))==0){z.sqrTo(r,r2);t=r;r=r2;r2=t;if(--i<0){i=this.DB-1;--j}}}return z.revert(r)}function bnGCD(a){var x=(this.s<0)?this.negate():this.clone();var y=(a.s<0)?a.negate():a.clone();if(x.compareTo(y)<0){var t=x;x=y;y=t}var i=x.getLowestSetBit(),g=y.getLowestSetBit();if(g<0){return x}if(i<g){g=i}if(g>0){x.rShiftTo(g,x);y.rShiftTo(g,y)}while(x.signum()>0){if((i=x.getLowestSetBit())>0){x.rShiftTo(i,x)}if((i=y.getLowestSetBit())>0){y.rShiftTo(i,y)}if(x.compareTo(y)>=0){x.subTo(y,x);x.rShiftTo(1,x)}else{y.subTo(x,y);y.rShiftTo(1,y)}}if(g>0){y.lShiftTo(g,y)}return y}function bnpModInt(n){if(n<=0){return 0}var d=this.DV%n,r=(this.s<0)?n-1:0;if(this.t>0){if(d==0){r=this[0]%n}else{for(var i=this.t-1;i>=0;--i){r=(d*r+this[i])%n}}}return r}function bnModInverse(m){var ac=m.isEven();if((this.isEven()&&ac)||m.signum()==0){return BigInteger.ZERO}var u=m.clone(),v=this.clone();var a=nbv(1),b=nbv(0),c=nbv(0),d=nbv(1);while(u.signum()!=0){while(u.isEven()){u.rShiftTo(1,u);if(ac){if(!a.isEven()||!b.isEven()){a.addTo(this,a);b.subTo(m,b)}a.rShiftTo(1,a)}else{if(!b.isEven()){b.subTo(m,b)}}b.rShiftTo(1,b)}while(v.isEven()){v.rShiftTo(1,v);if(ac){if(!c.isEven()||!d.isEven()){c.addTo(this,c);d.subTo(m,d)}c.rShiftTo(1,c)}else{if(!d.isEven()){d.subTo(m,d)}}d.rShiftTo(1,d)}if(u.compareTo(v)>=0){u.subTo(v,u);if(ac){a.subTo(c,a)}b.subTo(d,b)}else{v.subTo(u,v);if(ac){c.subTo(a,c)}d.subTo(b,d)}}if(v.compareTo(BigInteger.ONE)!=0){return BigInteger.ZERO}if(d.compareTo(m)>=0){return d.subtract(m)}if(d.signum()<0){d.addTo(m,d)}else{return d}if(d.signum()<0){return d.add(m)}else{return d}}proto.chunkSize=bnpChunkSize;proto.toRadix=bnpToRadix;proto.fromRadix=bnpFromRadix;proto.fromNumber=bnpFromNumber;proto.bitwiseTo=bnpBitwiseTo;proto.changeBit=bnpChangeBit;proto.addTo=bnpAddTo;proto.dMultiply=bnpDMultiply;proto.dAddOffset=bnpDAddOffset;proto.multiplyLowerTo=bnpMultiplyLowerTo;proto.multiplyUpperTo=bnpMultiplyUpperTo;proto.modInt=bnpModInt;proto.clone=bnClone;proto.intValue=bnIntValue;proto.byteValue=bnByteValue;proto.shortValue=bnShortValue;proto.signum=bnSigNum;proto.toByteArray=bnToByteArray;proto.equals=bnEquals;proto.min=bnMin;proto.max=bnMax;proto.and=bnAnd;proto.or=bnOr;proto.xor=bnXor;proto.andNot=bnAndNot;proto.not=bnNot;proto.shiftLeft=bnShiftLeft;proto.shiftRight=bnShiftRight;proto.getLowestSetBit=bnGetLowestSetBit;proto.bitCount=bnBitCount;proto.testBit=bnTestBit;proto.setBit=bnSetBit;proto.clearBit=bnClearBit;proto.flipBit=bnFlipBit;proto.add=bnAdd;proto.subtract=bnSubtract;proto.multiply=bnMultiply;proto.divide=bnDivide;proto.remainder=bnRemainder;proto.divideAndRemainder=bnDivideAndRemainder;proto.modPow=bnModPow;proto.modInverse=bnModInverse;proto.pow=bnPow;proto.gcd=bnGCD;proto.square=bnSquare;BigInteger.ZERO=nbv(0);BigInteger.ONE=nbv(1);BigInteger.valueOf=nbv;BigInteger.fromByteArrayUnsigned=function(ba){if(!ba.length){return new BigInteger.valueOf(0)}else{if(ba[0]&128){return new BigInteger([0].concat(ba))}else{return new BigInteger(ba)}}};BigInteger.fromByteArraySigned=function(ba){if(ba[0]&128){ba[0]&=127;return BigInteger.fromByteArrayUnsigned(ba).negate()}else{return BigInteger.fromByteArrayUnsigned(ba)}};BigInteger.prototype.toByteArrayUnsigned=function(){var ba=this.abs().toByteArray();if(!ba.length){return ba}if(ba[0]===0){ba=ba.slice(1)}for(var i=0;i<ba.length;++i){ba[i]=(ba[i]<0)?ba[i]+256:ba[i]}return ba};BigInteger.prototype.toByteArraySigned=function(){var val=this.toByteArrayUnsigned();var neg=this.s<0;if(val[0]&128){val.unshift((neg)?128:0)}else{if(neg){val[0]|=128}}return val};tool.set("cipher.asymmetric.ec.bigi",BigInteger)})(tool);(function(tool){function invoker(ECCurveFp,BigInteger){var ECPointFp=ECCurveFp.ECPointFp;function implShamirsTrick(P,k,Q,l){var m=Math.max(k.bitLength(),l.bitLength());var Z=P.add2D(Q);var R=P.curve.getInfinity();for(var i=m-1;i>=0;--i){R=R.twice2D();R.z=BigInteger.ONE;if(k.testBit(i)){if(l.testBit(i)){R=R.add2D(Z)}else{R=R.add2D(P)}}else{if(l.testBit(i)){R=R.add2D(Q)}}}return R}function ECDSA(ecparams){var self=this;var P_OVER_FOUR=null;var srand=new tool.get("util.srand")();var rng={nextBytes:function(arr){var byteArr=srand.bytes(arr.length);for(var i=0;i<byteArr.length;++i){arr[i]=byteArr[i]}}};this.sign=function(hash,priv){var d=priv;var n=ecparams.getN();var e=BigInteger.fromByteArrayUnsigned(hash);var k=getBigRandom(n);var G=ecparams.getG();var Q=G.multiply(k);var r=Q.getX().toBigInteger().mod(n);var s=k.modInverse(n).multiply(e.add(d.multiply(r))).mod(n);if(s.compareTo(n.divide(BigInteger.valueOf(2)))>0){s=n.subtract(s)}return serializeSig(r,s)};this.verify=function(hash,sig,pubkey){var r,s;if(Array.isArray(sig)){var obj=parseSig(sig);r=obj.r;s=obj.s}else{throw new Error("Invalid value for signature")}var Q;if(pubkey instanceof ECPointFp){Q=pubkey}else{if(Array.isArray(pubkey)){Q=ECPointFp.decodeFrom(ecparams.getCurve(),pubkey)}else{throw new Error("Invalid format for pubkey value, must be byte array or ECPointFp")}}var e=BigInteger.fromByteArrayUnsigned(hash);return verifyRaw(e,r,s,Q)};function verifyRaw(e,r,s,Q){var n=ecparams.getN();var G=ecparams.getG();if(r.compareTo(BigInteger.ONE)<0||r.compareTo(n)>=0){return false}if(s.compareTo(BigInteger.ONE)<0||s.compareTo(n)>=0){return false}var c=s.modInverse(n);var u1=e.multiply(c).mod(n);var u2=r.multiply(c).mod(n);var point=G.multiply(u1).add(Q.multiply(u2));var v=point.getX().toBigInteger().mod(n);return v.equals(r)}function parseSigCompact(sig){if(sig.length!==65){throw new Error("Signature has the wrong length")}var i=sig[0]-27;if(i<0||i>7){throw new Error("Invalid signature type")}var n=ecparams.getN();var r=BigInteger.fromByteArrayUnsigned(sig.slice(1,33)).mod(n);var s=BigInteger.fromByteArrayUnsigned(sig.slice(33,65)).mod(n);return{r:r,s:s,i:i}}function getBigRandom(limit){return new BigInteger(limit.bitLength(),rng).mod(limit.subtract(BigInteger.ONE)).add(BigInteger.ONE)}function serializeSig(r,s){var rBa=r.toByteArraySigned();var sBa=s.toByteArraySigned();var sequence=[];sequence.push(2);sequence.push(rBa.length);sequence=sequence.concat(rBa);sequence.push(2);sequence.push(sBa.length);sequence=sequence.concat(sBa);sequence.unshift(sequence.length);sequence.unshift(48);return sequence}function parseSig(sig){var cursor;if(sig[0]!=48){throw new Error("Signature not a valid DERSequence")}cursor=2;if(sig[cursor]!=2){throw new Error("First element in signature must be a DERInteger")}var rBa=sig.slice(cursor+2,cursor+2+sig[cursor+1]);cursor+=2+sig[cursor+1];if(sig[cursor]!=2){throw new Error("Second element in signature must be a DERInteger")}var sBa=sig.slice(cursor+2,cursor+2+sig[cursor+1]);cursor+=2+sig[cursor+1];var r=BigInteger.fromByteArrayUnsigned(rBa);var s=BigInteger.fromByteArrayUnsigned(sBa);return{r:r,s:s}}return this}return ECDSA}tool.set("cipher.asymmetric.ec.ecdsa",function(p){var ret=invoker(tool.get("cipher.asymmetric.ec.ecurve"),tool.get("cipher.asymmetric.ec.bigi"));return new ret(p)})})(tool);(function(tool){function EC(curveName){var self=this;var _ecparams=tool.get("cipher.asymmetric.ec.ecparams"),_ecdsa=tool.get("cipher.asymmetric.ec.ecdsa"),_ecurve=tool.get("cipher.asymmetric.ec.ecurve"),_bigi=tool.get("cipher.asymmetric.ec.bigi");var bigiPrivateKey=null,bigiPublicKey=null;var ecparams=_ecparams(curveName);if(!ecparams){throw Error("unknown-ec-curve-name")}var ecdsa=_ecdsa(ecparams);function toArray(uarray){var r=new Array(uarray.length);for(var i=0;i<r.length;i++){r[i]=uarray[i]}return r}this.setPrivateKey=function(privateKeyBuf){initWithPrivateKey(tool.get("util.encoding")(privateKeyBuf).toArray())};this.setPublicKey=function(publicKeyBuf){initWithPublicKey(tool.get("util.encoding")(publicKeyBuf).toArray())};function init(prv){if(prv){self.sign=sign;self.decrypt=decrypt;self._computeSecret=_computeSecret}self.verify=verify;self.encrypt=encrypt;self.getPublicKey=function(){return new Uint8Array(bigiPublicKey).buffer};delete self.setPrivateKey;delete self.setPublicKey}function initWithPublicKey(publicKeyArray){bigiPrivateKey=null;bigiPublicKey=publicKeyArray;init(false)}function initWithPrivateKey(privateKeyArray){bigiPrivateKey=_bigi.fromByteArrayUnsigned(privateKeyArray);var pubPoint=ecparams.getG().multiply(bigiPrivateKey);bigiPublicKey=pubPoint.getEncoded(false);init(true)}function sign(digestBuffer){if(!tool.get("util.type")(digestBuffer).isArrayBuffer()){throw new Error("invalid-parameter")}var signature=ecdsa.sign(tool.get("util.encoding")(digestBuffer).toArray(),bigiPrivateKey);return tool.get("util.encoding")(signature).toArrayBuffer()}function verify(digestBuffer,signatureBuffer){if(!(tool.get("util.type")(digestBuffer).isArrayBuffer()&&tool.get("util.type")(signatureBuffer).isArrayBuffer())){throw new Error("invalid-parameter")}try{var signatureArray=tool.get("util.encoding")(signatureBuffer).toArray(),digestArray=tool.get("util.encoding")(digestBuffer).toArray();var ret=ecdsa.verify(digestArray,signatureArray,bigiPublicKey)}catch(e){console.log(e);return false}return ret}function _computeSecret(anotherPublicKeyBuf){if(!tool.get("util.type")(anotherPublicKeyBuf).isArrayBuffer()){throw Error("invalid-parameter")}var anotherPublicKeyArray=tool.get("util.encoding")(anotherPublicKeyBuf).toArray();var Q=_ecurve.ECPointFp.decodeFrom(ecparams.getCurve(),anotherPublicKeyArray);var S=Q.multiply(bigiPrivateKey);var sharedsecretArray=S.getEncoded().slice(1);return tool.get("util.encoding")(sharedsecretArray).toArrayBuffer()}function encrypt(dataBuf){if(!tool.get("util.type")(dataBuf).isArrayBuffer()){throw new Error("invalid-parameter")}var tempEC=new EC(curveName);tempEC.setPrivateKey(new tool.get("util.srand")().bytes(64));var sharedsecret=tempEC._computeSecret(self.getPublicKey()),tempPublicKey=tempEC.getPublicKey();var encryptor=new tool.get("cipher.symmetric")().key(sharedsecret),ciphertextBuf=encryptor.encrypt(dataBuf);var lenBuf=new Uint16Array([tempPublicKey.byteLength]);return tool.get("util.buffer").concat([lenBuf.buffer,tempPublicKey,ciphertextBuf])}function decrypt(dataBuf){if(!(tool.get("util.type")(dataBuf).isArrayBuffer()&&dataBuf.byteLength>2)){throw new Error("invalid-parameter")}var lenBuf=dataBuf.slice(0,2),dataBuf=dataBuf.slice(2);var splitLen=new Uint16Array(lenBuf)[0];if(dataBuf.length<=splitLen){throw new Error("invalid-ciphertext")}var tempPublicKey=dataBuf.slice(0,splitLen),ciphertextBuf=dataBuf.slice(splitLen);var sharedsecret=_computeSecret(tempPublicKey);var decryptor=new tool.get("cipher.symmetric")().key(sharedsecret);var decryption=decryptor.decrypt(ciphertextBuf);return decryption}return this}var exporter={name:"EC",constructor:function(p){return new EC(p.curve)}};tool.set("cipher.asymmetric.ec",exporter)})(tool);(function(tool){var BigInteger,ECCurveFp;"use strict";function X9ECParameters(curve,g,n,h){this.curve=curve;this.g=g;this.n=n;this.h=h}X9ECParameters.prototype.getCurve=function x9getCurve(){return this.curve};X9ECParameters.prototype.getG=function x9getG(){return this.g};X9ECParameters.prototype.getN=function x9getN(){return this.n};X9ECParameters.prototype.getH=function x9getH(){return this.h};function fromHex(s){s=s.replace(/[^0-9a-f]/ig,"").toUpperCase();return new BigInteger(s,16)}var namedCurves={secp128r1:function(){var p=fromHex("FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF");var a=fromHex("FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC");var b=fromHex("E87579C11079F43DD824993C2CEE5ED3");var n=fromHex("FFFFFFFE0000000075A30D1B9038A115");var h=BigInteger.ONE;var curve=new ECCurveFp(p,a,b);var G=curve.decodePointHex("04161FF7528B899B2D0C28607CA52C5B86CF5AC8395BAFEB13C02DA292DDED7A83");return new X9ECParameters(curve,G,n,h)},secp160k1:function(){var p=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73");var a=BigInteger.ZERO;var b=fromHex("7");var n=fromHex("0100000000000000000001B8FA16DFAB9ACA16B6B3");var h=BigInteger.ONE;var curve=new ECCurveFp(p,a,b);var G=curve.decodePointHex("043B4C382CE37AA192A4019E763036F4F5DD4D7EBB938CF935318FDCED6BC28286531733C3F03C4FEE");return new X9ECParameters(curve,G,n,h)},secp160r1:function(){var p=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF");var a=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC");var b=fromHex("1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45");var n=fromHex("0100000000000000000001F4C8F927AED3CA752257");var h=BigInteger.ONE;var curve=new ECCurveFp(p,a,b);var G=curve.decodePointHex("044A96B5688EF573284664698968C38BB913CBFC8223A628553168947D59DCC912042351377AC5FB32");return new X9ECParameters(curve,G,n,h)},secp192k1:function(){var p=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37");var a=BigInteger.ZERO;var b=fromHex("3");var n=fromHex("FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D");var h=BigInteger.ONE;var curve=new ECCurveFp(p,a,b);var G=curve.decodePointHex("04DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D");return new X9ECParameters(curve,G,n,h)},secp192r1:function(){var p=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF");var a=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC");var b=fromHex("64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1");var n=fromHex("FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831");var h=BigInteger.ONE;var curve=new ECCurveFp(p,a,b);var G=curve.decodePointHex("04188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF101207192B95FFC8DA78631011ED6B24CDD573F977A11E794811");return new X9ECParameters(curve,G,n,h)},secp224r1:function(){var p=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001");var a=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE");var b=fromHex("B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4");var n=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D");var h=BigInteger.ONE;var curve=new ECCurveFp(p,a,b);var G=curve.decodePointHex("04B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34");return new X9ECParameters(curve,G,n,h)},secp256k1:function(){var p=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F");var a=BigInteger.ZERO;var b=fromHex("7");var n=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141");var h=BigInteger.ONE;var curve=new ECCurveFp(p,a,b);var G=curve.decodePointHex("0479BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8");return new X9ECParameters(curve,G,n,h)},secp256r1:function(){var p=fromHex("FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF");var a=fromHex("FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC");var b=fromHex("5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B");var n=fromHex("FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551");var h=BigInteger.ONE;var curve=new ECCurveFp(p,a,b);var G=curve.decodePointHex("046B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C2964FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5");return new X9ECParameters(curve,G,n,h)},secp384r1:function(){var p=fromHex("FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFe FFFFFFFF 00000000 00000000 FFFFFFFF");var a=fromHex("FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFe FFFFFFFF 00000000 00000000 FFFFFFFC");var b=fromHex("B3312FA7 E23EE7E4 988E056B E3F82D19 181D9C6E FE814112 0314088F 5013875A C656398D 8A2ED19D 2A85C8ED D3EC2AEF");var n=fromHex("FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF C7634D81 F4372DDF 581A0DB2 48B0A77A ECEC196A CCC52973");var h=BigInteger.ONE;var curve=new ECCurveFp(p,a,b);var G=curve.decodePointHex("04AA87CA22 BE8B0537 8EB1C71E F320AD74 6E1D3B62 8BA79B98 59F741E0 82542A38 5502F25D BF55296C 3A545E38 72760AB73617DE4A 96262C6F 5D9E98BF 9292DC29 F8F41DBD 289A147C E9DA3113 B5F0B8C0 0A60B1CE 1D7E819D 7A431D7C 90EA0E5F");return new X9ECParameters(curve,G,n,h)},secp521r1:function(){var p=fromHex("    01FF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFFFFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFFFFFFFFFF FFFFFFFF FFFFFFFF");var a=fromHex("    01FF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFFFFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFFFFFFFFFF FFFFFFFF FFFFFFFC");var b=fromHex("    0051 953EB961 8E1C9A1F 929A21A0 B68540EE A2DA725B 99B315F3B8B48991 8EF109E1 56193951 EC7E937B 1652C0BD 3BB1BF07 3573DF883D2C34F1 EF451FD4 6B503F00");var n=fromHex("    01FF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFF FFFFFFFFFFFFFFFF FFFFFFFA 51868783 BF2F966B 7FCC0148 F709A5D0 3BB5C9B8899C47AE BB6FB71E 91386409");var h=BigInteger.ONE;var curve=new ECCurveFp(p,a,b);var G=curve.decodePointHex("      04 00C6858E 06B70404 E9CD9E3E CB662395 B4429C64 8139053FB521F828 AF606B4D 3DBAA14B 5E77EFE7 5928FE1D C127A2FF A8DE3348B3C1856A 429BF97E 7E31C2E5 BD660118 39296A78 9A3BC004 5C8A5FB42C7D1BD9 98F54449 579B4468 17AFBD17 273E662C 97EE7299 5EF42640C550B901 3FAD0761 353C7086 A272C240 88BE9476 9FD16650");return new X9ECParameters(curve,G,n,h)}};tool.set("cipher.asymmetric.ec.ecparams",function getSECCurveByName(name){if(!BigInteger){BigInteger=tool.get("cipher.asymmetric.ec.bigi"),ECCurveFp=tool.get("cipher.asymmetric.ec.ecurve")}return(typeof namedCurves[name]=="function")?namedCurves[name]():null})})(tool);"use strict";(function(tool){var BigInteger;function integerToBytes(i,len){var bytes=i.toByteArrayUnsigned();if(len<bytes.length){bytes=bytes.slice(bytes.length-len)}else{while(len>bytes.length){bytes.unshift(0)}}return bytes}var ECFieldElementFp=function ECFieldElementFp(q,x){this.x=x;this.q=q};ECFieldElementFp.prototype.equals=function(other){if(other==this){return true}return(this.q.equals(other.q)&&this.x.equals(other.x))};ECFieldElementFp.prototype.toBigInteger=function(){return this.x};ECFieldElementFp.prototype.negate=function(){return new ECFieldElementFp(this.q,this.x.negate().mod(this.q))};ECFieldElementFp.prototype.add=function(b){return new ECFieldElementFp(this.q,this.x.add(b.toBigInteger()).mod(this.q))};ECFieldElementFp.prototype.subtract=function(b){return new ECFieldElementFp(this.q,this.x.subtract(b.toBigInteger()).mod(this.q))};ECFieldElementFp.prototype.multiply=function(b){return new ECFieldElementFp(this.q,this.x.multiply(b.toBigInteger()).mod(this.q))};ECFieldElementFp.prototype.square=function(){return new ECFieldElementFp(this.q,this.x.square().mod(this.q))};ECFieldElementFp.prototype.divide=function feFpDivide(b){return new ECFieldElementFp(this.q,this.x.multiply(b.toBigInteger().modInverse(this.q)).mod(this.q))};ECFieldElementFp.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)};var ECPointFp=function ECPointFp(curve,x,y,z){if(!BigInteger){BigInteger=tool.get("cipher.asymmetric.ec.bigi")}this.curve=curve;this.x=x;this.y=y;if(z==null){this.z=BigInteger.ONE}else{this.z=z}this.zinv=null};ECPointFp.prototype.getX=function(){if(this.zinv==null){this.zinv=this.z.modInverse(this.curve.q)}return this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))};ECPointFp.prototype.getY=function(){if(this.zinv==null){this.zinv=this.z.modInverse(this.curve.q)}return this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))};ECPointFp.prototype.equals=function(other){if(other==this){return true}if(this.isInfinity()){return other.isInfinity()}if(other.isInfinity()){return this.isInfinity()}var u,v;u=other.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(other.z)).mod(this.curve.q);if(!u.equals(BigInteger.ZERO)){return false}v=other.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(other.z)).mod(this.curve.q);return v.equals(BigInteger.ZERO)};ECPointFp.prototype.isInfinity=function(){if((this.x==null)&&(this.y==null)){return true}return this.z.equals(BigInteger.ZERO)&&!this.y.toBigInteger().equals(BigInteger.ZERO)};ECPointFp.prototype.negate=function(){return new ECPointFp(this.curve,this.x,this.y.negate(),this.z)};ECPointFp.prototype.add=function(b){if(this.isInfinity()){return b}if(b.isInfinity()){return this}var u=b.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(b.z)).mod(this.curve.q);var v=b.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(b.z)).mod(this.curve.q);if(BigInteger.ZERO.equals(v)){if(BigInteger.ZERO.equals(u)){return this.twice()}return this.curve.getInfinity()}var THREE=new BigInteger("3");var x1=this.x.toBigInteger();var y1=this.y.toBigInteger();var x2=b.x.toBigInteger();var y2=b.y.toBigInteger();var v2=v.square();var v3=v2.multiply(v);var x1v2=x1.multiply(v2);var zu2=u.square().multiply(this.z);var x3=zu2.subtract(x1v2.shiftLeft(1)).multiply(b.z).subtract(v3).multiply(v).mod(this.curve.q);var y3=x1v2.multiply(THREE).multiply(u).subtract(y1.multiply(v3)).subtract(zu2.multiply(u)).multiply(b.z).add(u.multiply(v3)).mod(this.curve.q);var z3=v3.multiply(this.z).multiply(b.z).mod(this.curve.q);return new ECPointFp(this.curve,this.curve.fromBigInteger(x3),this.curve.fromBigInteger(y3),z3)};ECPointFp.prototype.twice=function(){if(this.isInfinity()){return this}if(this.y.toBigInteger().signum()==0){return this.curve.getInfinity()}var THREE=new BigInteger("3");var x1=this.x.toBigInteger();var y1=this.y.toBigInteger();var y1z1=y1.multiply(this.z);var y1sqz1=y1z1.multiply(y1).mod(this.curve.q);var a=this.curve.a.toBigInteger();var w=x1.square().multiply(THREE);if(!BigInteger.ZERO.equals(a)){w=w.add(this.z.square().multiply(a))}w=w.mod(this.curve.q);var x3=w.square().subtract(x1.shiftLeft(3).multiply(y1sqz1)).shiftLeft(1).multiply(y1z1).mod(this.curve.q);var y3=w.multiply(THREE).multiply(x1).subtract(y1sqz1.shiftLeft(1)).shiftLeft(2).multiply(y1sqz1).subtract(w.square().multiply(w)).mod(this.curve.q);var z3=y1z1.square().multiply(y1z1).shiftLeft(3).mod(this.curve.q);return new ECPointFp(this.curve,this.curve.fromBigInteger(x3),this.curve.fromBigInteger(y3),z3)};ECPointFp.prototype.multiply=function(k){if(this.isInfinity()){return this}if(k.signum()==0){return this.curve.getInfinity()}var e=k;var h=e.multiply(new BigInteger("3"));var neg=this.negate();var R=this;var i;for(i=h.bitLength()-2;i>0;--i){R=R.twice();var hBit=h.testBit(i);var eBit=e.testBit(i);if(hBit!=eBit){R=R.add(hBit?this:neg)}}return R};ECPointFp.prototype.multiplyTwo=function(j,x,k){var i;if(j.bitLength()>k.bitLength()){i=j.bitLength()-1}else{i=k.bitLength()-1}var R=this.curve.getInfinity();var both=this.add(x);while(i>=0){R=R.twice();if(j.testBit(i)){if(k.testBit(i)){R=R.add(both)}else{R=R.add(this)}}else{if(k.testBit(i)){R=R.add(x)}}--i}return R};ECPointFp.prototype.getEncoded=function(compressed){if(this.isInfinity()){return[0]}var x=this.getX().toBigInteger();var y=this.getY().toBigInteger();var byteLength=Math.floor((this.curve.getQ().bitLength()+7)/8);var enc=integerToBytes(x,byteLength);if(compressed){if(y.isEven()){enc.unshift(2)}else{enc.unshift(3)}}else{enc.unshift(4);enc=enc.concat(integerToBytes(y,byteLength))}return enc};ECPointFp.decodeFrom=function(curve,enc){var type=enc[0];var dataLen=enc.length-1;var xBa=enc.slice(1,1+dataLen/2);var yBa=enc.slice(1+dataLen/2,1+dataLen);xBa.unshift(0);yBa.unshift(0);var x=new BigInteger(xBa);var y=new BigInteger(yBa);return new ECPointFp(curve,curve.fromBigInteger(x),curve.fromBigInteger(y))};ECPointFp.prototype.add2D=function(b){if(this.isInfinity()){return b}if(b.isInfinity()){return this}if(this.x.equals(b.x)){if(this.y.equals(b.y)){return this.twice()}return this.curve.getInfinity()}var x_x=b.x.subtract(this.x);var y_y=b.y.subtract(this.y);var gamma=y_y.divide(x_x);var x3=gamma.square().subtract(this.x).subtract(b.x);var y3=gamma.multiply(this.x.subtract(x3)).subtract(this.y);return new ECPointFp(this.curve,x3,y3)};ECPointFp.prototype.twice2D=function(){if(this.isInfinity()){return this}if(this.y.toBigInteger().signum()==0){return this.curve.getInfinity()}var TWO=this.curve.fromBigInteger(BigInteger.valueOf(2));var THREE=this.curve.fromBigInteger(BigInteger.valueOf(3));var gamma=this.x.square().multiply(THREE).add(this.curve.a).divide(this.y.multiply(TWO));var x3=gamma.square().subtract(this.x.multiply(TWO));var y3=gamma.multiply(this.x.subtract(x3)).subtract(this.y);return new ECPointFp(this.curve,x3,y3)};ECPointFp.prototype.multiply2D=function(k){if(this.isInfinity()){return this}if(k.signum()==0){return this.curve.getInfinity()}var e=k;var h=e.multiply(new BigInteger("3"));var neg=this.negate();var R=this;var i;for(i=h.bitLength()-2;i>0;--i){R=R.twice();var hBit=h.testBit(i);var eBit=e.testBit(i);if(hBit!=eBit){R=R.add2D(hBit?this:neg)}}return R};ECPointFp.prototype.isOnCurve=function(){if(this.isInfinity()){return true}var x=this.getX().toBigInteger();var y=this.getY().toBigInteger();var a=this.curve.getA().toBigInteger();var b=this.curve.getB().toBigInteger();var n=this.curve.getQ();var lhs=y.multiply(y).mod(n);var rhs=x.multiply(x).multiply(x).add(a.multiply(x)).add(b).mod(n);return lhs.equals(rhs)};ECPointFp.prototype.toString=function(){if(this.isInfinity()){return"(INFINITY)"}return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"};ECPointFp.prototype.validate=function(){var n=this.curve.getQ();if(this.isInfinity()){throw new Error("Point is at infinity.")}var x=this.getX().toBigInteger();var y=this.getY().toBigInteger();if(x.compareTo(BigInteger.ONE)<0||x.compareTo(n.subtract(BigInteger.ONE))>0){throw new Error("x coordinate out of bounds")}if(y.compareTo(BigInteger.ONE)<0||y.compareTo(n.subtract(BigInteger.ONE))>0){throw new Error("y coordinate out of bounds")}if(!this.isOnCurve()){throw new Error("Point is not on the curve.")}if(this.multiply(n).isInfinity()){throw new Error("Point is not a scalar multiple of G.")}return true};var ECCurveFp=function ECCurveFp(q,a,b){this.q=q;this.a=this.fromBigInteger(a);this.b=this.fromBigInteger(b);this.infinity=new ECPointFp(this,null,null)};ECCurveFp.prototype.getQ=function(){return this.q};ECCurveFp.prototype.getA=function(){return this.a};ECCurveFp.prototype.getB=function(){return this.b};ECCurveFp.prototype.equals=function(other){if(other==this){return true}return(this.q.equals(other.q)&&this.a.equals(other.a)&&this.b.equals(other.b))};ECCurveFp.prototype.getInfinity=function(){return this.infinity};ECCurveFp.prototype.fromBigInteger=function(x){return new ECFieldElementFp(this.q,x)};ECCurveFp.prototype.decodePointHex=function(s){s=s.replace(/[^0-9a-f]/ig,"");switch(parseInt(s.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:return null;case 4:case 6:case 7:var len=(s.length-2)/2;var xHex=s.substr(2,len);var yHex=s.substr(len+2,len);return new ECPointFp(this,this.fromBigInteger(new BigInteger(xHex,16)),this.fromBigInteger(new BigInteger(yHex,16)));default:return null}};ECCurveFp.ECPointFp=ECPointFp;tool.set("cipher.asymmetric.ec.ecurve",ECCurveFp)})(tool);(function(tool){var cipherToolkit={};var definition={NECRAC128:{name:"NECRAC128",secretLength:32,sign:{algorithm:"ec",parameters:{curve:"secp256r1"},secretLength:32},crypt:{algorithm:"curve25519",parameters:{},secretLength:32},hashLength:32}};function AsymmetricCipher(algorithmName){var self=this;var algorithmSuite=definition[algorithmName];var pkSigning,pkEncrypting;if(!algorithmSuite){throw new Error("invalid-algorithm-choice")}function _digest(dataBuf){var hasher=new tool.get("hash")(algorithmSuite.hashLength);return hasher.hash(dataBuf).buffer}function _loadAsymModule(conf){var constructor=tool.get("cipher.asymmetric."+conf.algorithm).constructor;return constructor(conf.parameters)}pkSigning=_loadAsymModule(algorithmSuite.sign);pkEncrypting=_loadAsymModule(algorithmSuite.crypt);function init(prv){if(prv){self.sign=sign;self.decrypt=decrypt}self.verify=verify;self.encrypt=encrypt;self.getPublicKey=getPublicKey;delete self.setPrivateKey;delete self.setPublicKey}function getPublicKey(){var dataVerifying=pkSigning.getPublicKey(),dataEncrypting=pkEncrypting.getPublicKey();return tool.get("util.buffer").concat([new Uint16Array([dataVerifying.byteLength]).buffer,dataVerifying,dataEncrypting])}function sign(dataBuf){if(!tool.get("util.type")(dataBuf).isArrayBuffer()){throw new Error("invalid-parameter")}var digestBuf=_digest(dataBuf);return pkSigning.sign(digestBuf)}function verify(dataBuf,signatureBuf){if(!(tool.get("util.type")(dataBuf).isArrayBuffer()&&tool.get("util.type")(signatureBuf).isArrayBuffer())){throw new Error("invalid-parameter")}var digestBuf=_digest(dataBuf);return pkSigning.verify(digestBuf,signatureBuf)}function encrypt(plaintextBuf){if(!tool.get("util.type")(plaintextBuf).isArrayBuffer()){throw new Error("invalid-parameter")}return pkEncrypting.encrypt(plaintextBuf)}function decrypt(ciphertextBuf){if(!tool.get("util.type")(ciphertextBuf).isArrayBuffer()){throw new Error("invalid-parameter")}return pkEncrypting.decrypt(ciphertextBuf)}this.setPrivateKey=function(credentialBuf){if(!tool.get("util.type")(credentialBuf).isArrayBuffer()){throw new Error("invalid-parameter")}var pbkdf2=new tool.get("hash")(algorithmSuite.hashAlgorithm).pbkdf2;var secretSigning=pbkdf2(credentialBuf,tool.get("util.encoding")("derivation-of-signing-key","ascii").toArrayBuffer(),4,algorithmSuite.sign.secretLength);var secretDecrypting=pbkdf2(credentialBuf,tool.get("util.encoding")("derivation-of-encrypting-key","ascii").toArrayBuffer(),4,algorithmSuite.crypt.secretLength);try{pkSigning.setPrivateKey(secretSigning);pkEncrypting.setPrivateKey(secretDecrypting)}catch(e){throw new Error("invalid-private-key")}init(true)};this.setPublicKey=function(publicKeyBuf){if(!(tool.get("util.type")(publicKeyBuf).isArrayBuffer()&&publicKeyBuf.byteLength>2)){throw new Error("invalid-public-key")}var splitLen=new Uint16Array(publicKeyBuf.slice(0,2))[0];publicKeyBuf=publicKeyBuf.slice(2);if(publicKeyBuf.byteLength<=splitLen){throw new Error("invalid-public-key")}var dataVerifying=publicKeyBuf.slice(0,splitLen),dataEncrypting=publicKeyBuf.slice(splitLen);try{pkSigning.setPublicKey(dataVerifying);pkEncrypting.setPublicKey(dataEncrypting)}catch(e){throw new Error("invalid-public-key")}init(false)};return this}function cipherInitializer(cipherConf){if(cipherConf){tool.get("util.log").notice("Load asymmetric cipher component: ["+cipherConf.name+"]");cipherToolkit[cipherConf.name]=cipherConf.constructor;return}if("undefined"!=typeof cipherToolkit.EC){tool.get("util.log").notice("Asymmetric ciphers ready.");return function(x){return new AsymmetricCipher(x)}}return null}var exporter=function(x){return new AsymmetricCipher(x)};tool.set("cipher.asymmetric",exporter);tool.set("cipher.asymmetric.definition",function(algoname){return definition[algoname]||null});tool.exp("cipher.asymmetric",exporter)})(tool);(function(tool){var c255lhexchars="0123456789abcdef";var c255lhexvalues={"0":0,"1":1,"2":2,"3":3,"4":4,"5":5,"6":6,"7":7,"8":8,"9":9,a:10,b:11,c:12,d:13,e:14,f:15};function c255lhexencode(n){var c;var r="";for(c=0;c<255;c+=4){r=c255lhexchars.substr(c255lgetbit(n,c)+(c255lgetbit(n,c+1)<<1)+(c255lgetbit(n,c+2)<<2)+(c255lgetbit(n,c+3)<<3),1)+r}return r}function c255lhexdecode(n){var c=0;var r=c255lzero();var l=n.length;for(c=0;(l>0)&&(c<255);c+=4){l--;var v=c255lhexvalues[n.substr(l,1)];c255lsetbit(r,c,v&1);v=v>>1;c255lsetbit(r,c+1,v&1);v=v>>1;c255lsetbit(r,c+2,v&1);v=v>>1;c255lsetbit(r,c+3,v&1)}return r}var c255lprime=[65535-18,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,32767];function c255lsetbit(n,c,v){var i=c>>4;var a=n[i];a=a+(1<<(c&15))*v;n[i]=a}function c255lgetbit(n,c){return(n[c>>4]>>(c&15))&1}function c255lzero(){return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}function c255lone(){return[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}function c255lbase(){return[9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}function c255lbigintcmp(a,b){var c,abs_r,mask;var r=0;for(c=15;c>=0;c--){var x=a[c];var y=b[c];r=r+(x-y)*(1-r*r);mask=r>>31;abs_r=(r+mask)^mask;r=~~((r<<1)/(abs_r+1))}return r}function c255lbigintadd(a,b){var r=[];var v;r[0]=(v=a[0]+b[0])&65535;r[1]=(v=(v>>>16)+a[1]+b[1])&65535;r[2]=(v=(v>>>16)+a[2]+b[2])&65535;r[3]=(v=(v>>>16)+a[3]+b[3])&65535;r[4]=(v=(v>>>16)+a[4]+b[4])&65535;r[5]=(v=(v>>>16)+a[5]+b[5])&65535;r[6]=(v=(v>>>16)+a[6]+b[6])&65535;r[7]=(v=(v>>>16)+a[7]+b[7])&65535;r[8]=(v=(v>>>16)+a[8]+b[8])&65535;r[9]=(v=(v>>>16)+a[9]+b[9])&65535;r[10]=(v=(v>>>16)+a[10]+b[10])&65535;r[11]=(v=(v>>>16)+a[11]+b[11])&65535;r[12]=(v=(v>>>16)+a[12]+b[12])&65535;r[13]=(v=(v>>>16)+a[13]+b[13])&65535;r[14]=(v=(v>>>16)+a[14]+b[14])&65535;r[15]=(v>>>16)+a[15]+b[15];return r}function c255lbigintsub(a,b){var r=[];var v;r[0]=(v=524288+a[0]-b[0])&65535;r[1]=(v=(v>>>16)+524280+a[1]-b[1])&65535;r[2]=(v=(v>>>16)+524280+a[2]-b[2])&65535;r[3]=(v=(v>>>16)+524280+a[3]-b[3])&65535;r[4]=(v=(v>>>16)+524280+a[4]-b[4])&65535;r[5]=(v=(v>>>16)+524280+a[5]-b[5])&65535;r[6]=(v=(v>>>16)+524280+a[6]-b[6])&65535;r[7]=(v=(v>>>16)+524280+a[7]-b[7])&65535;r[8]=(v=(v>>>16)+524280+a[8]-b[8])&65535;r[9]=(v=(v>>>16)+524280+a[9]-b[9])&65535;r[10]=(v=(v>>>16)+524280+a[10]-b[10])&65535;r[11]=(v=(v>>>16)+524280+a[11]-b[11])&65535;r[12]=(v=(v>>>16)+524280+a[12]-b[12])&65535;r[13]=(v=(v>>>16)+524280+a[13]-b[13])&65535;r[14]=(v=(v>>>16)+524280+a[14]-b[14])&65535;r[15]=(v>>>16)-8+a[15]-b[15];return r}function c255lsqr8h(a7,a6,a5,a4,a3,a2,a1,a0){var r=[];var v;r[0]=(v=a0*a0)&65535;r[1]=(v=(0|(v/65536))+2*a0*a1)&65535;r[2]=(v=(0|(v/65536))+2*a0*a2+a1*a1)&65535;r[3]=(v=(0|(v/65536))+2*a0*a3+2*a1*a2)&65535;r[4]=(v=(0|(v/65536))+2*a0*a4+2*a1*a3+a2*a2)&65535;r[5]=(v=(0|(v/65536))+2*a0*a5+2*a1*a4+2*a2*a3)&65535;r[6]=(v=(0|(v/65536))+2*a0*a6+2*a1*a5+2*a2*a4+a3*a3)&65535;r[7]=(v=(0|(v/65536))+2*a0*a7+2*a1*a6+2*a2*a5+2*a3*a4)&65535;r[8]=(v=(0|(v/65536))+2*a1*a7+2*a2*a6+2*a3*a5+a4*a4)&65535;r[9]=(v=(0|(v/65536))+2*a2*a7+2*a3*a6+2*a4*a5)&65535;r[10]=(v=(0|(v/65536))+2*a3*a7+2*a4*a6+a5*a5)&65535;r[11]=(v=(0|(v/65536))+2*a4*a7+2*a5*a6)&65535;r[12]=(v=(0|(v/65536))+2*a5*a7+a6*a6)&65535;r[13]=(v=(0|(v/65536))+2*a6*a7)&65535;r[14]=(v=(0|(v/65536))+a7*a7)&65535;r[15]=0|(v/65536);return r}function c255lsqrmodp(a){var x=c255lsqr8h(a[15],a[14],a[13],a[12],a[11],a[10],a[9],a[8]);var z=c255lsqr8h(a[7],a[6],a[5],a[4],a[3],a[2],a[1],a[0]);var y=c255lsqr8h(a[15]+a[7],a[14]+a[6],a[13]+a[5],a[12]+a[4],a[11]+a[3],a[10]+a[2],a[9]+a[1],a[8]+a[0]);var r=[];var v;r[0]=(v=8388608+z[0]+(y[8]-x[8]-z[8]+x[0]-128)*38)&65535;r[1]=(v=8388480+(v>>>16)+z[1]+(y[9]-x[9]-z[9]+x[1])*38)&65535;r[2]=(v=8388480+(v>>>16)+z[2]+(y[10]-x[10]-z[10]+x[2])*38)&65535;r[3]=(v=8388480+(v>>>16)+z[3]+(y[11]-x[11]-z[11]+x[3])*38)&65535;r[4]=(v=8388480+(v>>>16)+z[4]+(y[12]-x[12]-z[12]+x[4])*38)&65535;r[5]=(v=8388480+(v>>>16)+z[5]+(y[13]-x[13]-z[13]+x[5])*38)&65535;r[6]=(v=8388480+(v>>>16)+z[6]+(y[14]-x[14]-z[14]+x[6])*38)&65535;r[7]=(v=8388480+(v>>>16)+z[7]+(y[15]-x[15]-z[15]+x[7])*38)&65535;r[8]=(v=8388480+(v>>>16)+z[8]+y[0]-x[0]-z[0]+x[8]*38)&65535;r[9]=(v=8388480+(v>>>16)+z[9]+y[1]-x[1]-z[1]+x[9]*38)&65535;r[10]=(v=8388480+(v>>>16)+z[10]+y[2]-x[2]-z[2]+x[10]*38)&65535;r[11]=(v=8388480+(v>>>16)+z[11]+y[3]-x[3]-z[3]+x[11]*38)&65535;r[12]=(v=8388480+(v>>>16)+z[12]+y[4]-x[4]-z[4]+x[12]*38)&65535;r[13]=(v=8388480+(v>>>16)+z[13]+y[5]-x[5]-z[5]+x[13]*38)&65535;r[14]=(v=8388480+(v>>>16)+z[14]+y[6]-x[6]-z[6]+x[14]*38)&65535;r[15]=8388480+(v>>>16)+z[15]+y[7]-x[7]-z[7]+x[15]*38;c255lreduce(r);return r}function c255lmul8h(a7,a6,a5,a4,a3,a2,a1,a0,b7,b6,b5,b4,b3,b2,b1,b0){var r=[];var v;r[0]=(v=a0*b0)&65535;r[1]=(v=(0|(v/65536))+a0*b1+a1*b0)&65535;r[2]=(v=(0|(v/65536))+a0*b2+a1*b1+a2*b0)&65535;r[3]=(v=(0|(v/65536))+a0*b3+a1*b2+a2*b1+a3*b0)&65535;r[4]=(v=(0|(v/65536))+a0*b4+a1*b3+a2*b2+a3*b1+a4*b0)&65535;r[5]=(v=(0|(v/65536))+a0*b5+a1*b4+a2*b3+a3*b2+a4*b1+a5*b0)&65535;r[6]=(v=(0|(v/65536))+a0*b6+a1*b5+a2*b4+a3*b3+a4*b2+a5*b1+a6*b0)&65535;r[7]=(v=(0|(v/65536))+a0*b7+a1*b6+a2*b5+a3*b4+a4*b3+a5*b2+a6*b1+a7*b0)&65535;r[8]=(v=(0|(v/65536))+a1*b7+a2*b6+a3*b5+a4*b4+a5*b3+a6*b2+a7*b1)&65535;r[9]=(v=(0|(v/65536))+a2*b7+a3*b6+a4*b5+a5*b4+a6*b3+a7*b2)&65535;r[10]=(v=(0|(v/65536))+a3*b7+a4*b6+a5*b5+a6*b4+a7*b3)&65535;r[11]=(v=(0|(v/65536))+a4*b7+a5*b6+a6*b5+a7*b4)&65535;r[12]=(v=(0|(v/65536))+a5*b7+a6*b6+a7*b5)&65535;r[13]=(v=(0|(v/65536))+a6*b7+a7*b6)&65535;r[14]=(v=(0|(v/65536))+a7*b7)&65535;r[15]=(0|(v/65536));return r}function c255lmulmodp(a,b){var x=c255lmul8h(a[15],a[14],a[13],a[12],a[11],a[10],a[9],a[8],b[15],b[14],b[13],b[12],b[11],b[10],b[9],b[8]);var z=c255lmul8h(a[7],a[6],a[5],a[4],a[3],a[2],a[1],a[0],b[7],b[6],b[5],b[4],b[3],b[2],b[1],b[0]);var y=c255lmul8h(a[15]+a[7],a[14]+a[6],a[13]+a[5],a[12]+a[4],a[11]+a[3],a[10]+a[2],a[9]+a[1],a[8]+a[0],b[15]+b[7],b[14]+b[6],b[13]+b[5],b[12]+b[4],b[11]+b[3],b[10]+b[2],b[9]+b[1],b[8]+b[0]);var r=[];var v;r[0]=(v=8388608+z[0]+(y[8]-x[8]-z[8]+x[0]-128)*38)&65535;r[1]=(v=8388480+(v>>>16)+z[1]+(y[9]-x[9]-z[9]+x[1])*38)&65535;r[2]=(v=8388480+(v>>>16)+z[2]+(y[10]-x[10]-z[10]+x[2])*38)&65535;r[3]=(v=8388480+(v>>>16)+z[3]+(y[11]-x[11]-z[11]+x[3])*38)&65535;r[4]=(v=8388480+(v>>>16)+z[4]+(y[12]-x[12]-z[12]+x[4])*38)&65535;r[5]=(v=8388480+(v>>>16)+z[5]+(y[13]-x[13]-z[13]+x[5])*38)&65535;r[6]=(v=8388480+(v>>>16)+z[6]+(y[14]-x[14]-z[14]+x[6])*38)&65535;r[7]=(v=8388480+(v>>>16)+z[7]+(y[15]-x[15]-z[15]+x[7])*38)&65535;r[8]=(v=8388480+(v>>>16)+z[8]+y[0]-x[0]-z[0]+x[8]*38)&65535;r[9]=(v=8388480+(v>>>16)+z[9]+y[1]-x[1]-z[1]+x[9]*38)&65535;r[10]=(v=8388480+(v>>>16)+z[10]+y[2]-x[2]-z[2]+x[10]*38)&65535;r[11]=(v=8388480+(v>>>16)+z[11]+y[3]-x[3]-z[3]+x[11]*38)&65535;r[12]=(v=8388480+(v>>>16)+z[12]+y[4]-x[4]-z[4]+x[12]*38)&65535;r[13]=(v=8388480+(v>>>16)+z[13]+y[5]-x[5]-z[5]+x[13]*38)&65535;r[14]=(v=8388480+(v>>>16)+z[14]+y[6]-x[6]-z[6]+x[14]*38)&65535;r[15]=8388480+(v>>>16)+z[15]+y[7]-x[7]-z[7]+x[15]*38;c255lreduce(r);return r}function c255lreduce(a){var v=a[15];a[15]=v&32767;v=(0|(v/32768))*19;a[0]=(v+=a[0])&65535;v=v>>>16;a[1]=(v+=a[1])&65535;v=v>>>16;a[2]=(v+=a[2])&65535;v=v>>>16;a[3]=(v+=a[3])&65535;v=v>>>16;a[4]=(v+=a[4])&65535;v=v>>>16;a[5]=(v+=a[5])&65535;v=v>>>16;a[6]=(v+=a[6])&65535;v=v>>>16;a[7]=(v+=a[7])&65535;v=v>>>16;a[8]=(v+=a[8])&65535;v=v>>>16;a[9]=(v+=a[9])&65535;v=v>>>16;a[10]=(v+=a[10])&65535;v=v>>>16;a[11]=(v+=a[11])&65535;v=v>>>16;a[12]=(v+=a[12])&65535;v=v>>>16;a[13]=(v+=a[13])&65535;v=v>>>16;a[14]=(v+=a[14])&65535;v=v>>>16;a[15]+=v}function c255laddmodp(a,b){var r=[];var v;r[0]=(v=((0|(a[15]>>>15))+(0|(b[15]>>>15)))*19+a[0]+b[0])&65535;r[1]=(v=(v>>>16)+a[1]+b[1])&65535;r[2]=(v=(v>>>16)+a[2]+b[2])&65535;r[3]=(v=(v>>>16)+a[3]+b[3])&65535;r[4]=(v=(v>>>16)+a[4]+b[4])&65535;r[5]=(v=(v>>>16)+a[5]+b[5])&65535;r[6]=(v=(v>>>16)+a[6]+b[6])&65535;r[7]=(v=(v>>>16)+a[7]+b[7])&65535;r[8]=(v=(v>>>16)+a[8]+b[8])&65535;r[9]=(v=(v>>>16)+a[9]+b[9])&65535;r[10]=(v=(v>>>16)+a[10]+b[10])&65535;r[11]=(v=(v>>>16)+a[11]+b[11])&65535;r[12]=(v=(v>>>16)+a[12]+b[12])&65535;r[13]=(v=(v>>>16)+a[13]+b[13])&65535;r[14]=(v=(v>>>16)+a[14]+b[14])&65535;r[15]=(v>>>16)+(a[15]&32767)+(b[15]&32767);return r}function c255lsubmodp(a,b){var r=[];var v;r[0]=(v=524288+((0|(a[15]>>>15))-(0|(b[15]>>>15))-1)*19+a[0]-b[0])&65535;r[1]=(v=(v>>>16)+524280+a[1]-b[1])&65535;r[2]=(v=(v>>>16)+524280+a[2]-b[2])&65535;r[3]=(v=(v>>>16)+524280+a[3]-b[3])&65535;r[4]=(v=(v>>>16)+524280+a[4]-b[4])&65535;r[5]=(v=(v>>>16)+524280+a[5]-b[5])&65535;r[6]=(v=(v>>>16)+524280+a[6]-b[6])&65535;r[7]=(v=(v>>>16)+524280+a[7]-b[7])&65535;r[8]=(v=(v>>>16)+524280+a[8]-b[8])&65535;r[9]=(v=(v>>>16)+524280+a[9]-b[9])&65535;r[10]=(v=(v>>>16)+524280+a[10]-b[10])&65535;r[11]=(v=(v>>>16)+524280+a[11]-b[11])&65535;r[12]=(v=(v>>>16)+524280+a[12]-b[12])&65535;r[13]=(v=(v>>>16)+524280+a[13]-b[13])&65535;r[14]=(v=(v>>>16)+524280+a[14]-b[14])&65535;r[15]=(v>>>16)+32760+(a[15]&32767)-(b[15]&32767);return r}function c255linvmodp(a){var c=a;var i=250;while(--i){a=c255lsqrmodp(a);a=c255lmulmodp(a,c)}a=c255lsqrmodp(a);a=c255lsqrmodp(a);a=c255lmulmodp(a,c);a=c255lsqrmodp(a);a=c255lsqrmodp(a);a=c255lmulmodp(a,c);a=c255lsqrmodp(a);a=c255lmulmodp(a,c);return a}function c255lmulasmall(a){var m=121665;var r=[];var v;r[0]=(v=a[0]*m)&65535;r[1]=(v=(0|(v/65536))+a[1]*m)&65535;r[2]=(v=(0|(v/65536))+a[2]*m)&65535;r[3]=(v=(0|(v/65536))+a[3]*m)&65535;r[4]=(v=(0|(v/65536))+a[4]*m)&65535;r[5]=(v=(0|(v/65536))+a[5]*m)&65535;r[6]=(v=(0|(v/65536))+a[6]*m)&65535;r[7]=(v=(0|(v/65536))+a[7]*m)&65535;r[8]=(v=(0|(v/65536))+a[8]*m)&65535;r[9]=(v=(0|(v/65536))+a[9]*m)&65535;r[10]=(v=(0|(v/65536))+a[10]*m)&65535;r[11]=(v=(0|(v/65536))+a[11]*m)&65535;r[12]=(v=(0|(v/65536))+a[12]*m)&65535;r[13]=(v=(0|(v/65536))+a[13]*m)&65535;r[14]=(v=(0|(v/65536))+a[14]*m)&65535;r[15]=(0|(v/65536))+a[15]*m;c255lreduce(r);return r}function c255ldbl(x,z){var x_2,z_2,m,n,o;m=c255lsqrmodp(c255laddmodp(x,z));n=c255lsqrmodp(c255lsubmodp(x,z));o=c255lsubmodp(m,n);x_2=c255lmulmodp(n,m);z_2=c255lmulmodp(c255laddmodp(c255lmulasmall(o),m),o);return[x_2,z_2]}function c255lsum(x,z,x_p,z_p,x_1){var x_3,z_3,p,q;p=c255lmulmodp(c255lsubmodp(x,z),c255laddmodp(x_p,z_p));q=c255lmulmodp(c255laddmodp(x,z),c255lsubmodp(x_p,z_p));x_3=c255lsqrmodp(c255laddmodp(p,q));z_3=c255lmulmodp(c255lsqrmodp(c255lsubmodp(p,q)),x_1);return[x_3,z_3]}function curve25519_raw(f,c){var a,x_1,q;x_1=c;a=c255ldbl(x_1,c255lone());q=[x_1.slice(0),c255lone()];var n=255;while(c255lgetbit(f,n)==0){n--;if(n<0){return c255lzero()}}n--;while(n>=0){var r,s;var b=c255lgetbit(f,n);var a_or_q=[[],[]];cond_copy(a_or_q[0],q[0],a[0],b);cond_copy(a_or_q[1],q[1],a[1],b);r=c255lsum(a[0],a[1],q[0],q[1],x_1);s=c255ldbl(a_or_q[0],a_or_q[1]);cond_copy(q[0],s[0],r[0],b);cond_copy(q[1],s[1],r[1],b);cond_copy(a[0],r[0],s[0],b);cond_copy(a[1],r[1],s[1],b);n--}q[1]=c255linvmodp(q[1]);q[0]=c255lmulmodp(q[0],q[1]);c255lreduce(q[0]);return q[0];function cond_copy(r,a,b,c){var m2=(-c)&65535;var m1=(~m2)&65535;var n=0;while(n<16){r[n]=(a[n]&m1)|(b[n]&m2);n++}}}function curve25519b32(a,b){return c255lbase32encode(curve25519(c255lbase32decode(a),c255lbase32decode(b)))}function curve25519(f,c){if(!c){c=c255lbase()}f[0]&=65528;f[15]=(f[15]&32767)|16384;c[15]&=32767;return curve25519_raw(f,c)}function curve25519Interface(params){var self=this;var internalPrivateKey,internalPublicKey;this.setPrivateKey=function(privateKeyBuf){initWithPrivateKey(tool.get("util.encoding")(privateKeyBuf).toHEX())};this.setPublicKey=function(publicKeyBuf){initWithPublicKey(tool.get("util.encoding")(publicKeyBuf).toHEX())};function init(prv){if(prv){self.decrypt=decrypt;self._computeSecret=_computeSecret}self.encrypt=encrypt;self.getPublicKey=function(){var hex=c255lhexencode(internalPublicKey);return tool.get("util.encoding")(hex,"hex").toArrayBuffer()};delete self.setPrivateKey;delete self.setPublicKey}function initWithPublicKey(publicKeyHEX){internalPrivateKey=null;internalPublicKey=c255lhexdecode(publicKeyHEX);init(false)}function initWithPrivateKey(privateKeyHEX){internalPrivateKey=c255lhexdecode(privateKeyHEX);internalPublicKey=curve25519(internalPrivateKey);init(true)}function _computeSecret(anotherPublicKeyBuf){if(!tool.get("util.type")(anotherPublicKeyBuf).isArrayBuffer()){throw Error("invalid-parameter")}var anotherPublicKeyHEX=tool.get("util.encoding")(anotherPublicKeyBuf).toHEX();var sharedsecretArray=curve25519(internalPrivateKey,c255lhexdecode(anotherPublicKeyHEX));var retHEX=c255lhexencode(sharedsecretArray);return tool.get("util.encoding")(retHEX,"hex").toArrayBuffer()}function encrypt(dataBuf){if(!tool.get("util.type")(dataBuf).isArrayBuffer()){throw new Error("invalid-parameter")}var tempCurve25519=new curve25519Interface();tempCurve25519.setPrivateKey(new tool.get("util.srand")().bytes(32));var sharedsecret=tempCurve25519._computeSecret(self.getPublicKey()),tempPublicKey=tempCurve25519.getPublicKey();var encryptor=new tool.get("cipher.symmetric")().key(sharedsecret),ciphertextBuf=encryptor.encrypt(dataBuf);return tool.get("util.buffer").concat([tempPublicKey,ciphertextBuf])}function decrypt(dataBuf){if(!(tool.get("util.type")(dataBuf).isArrayBuffer()&&dataBuf.byteLength>32)){throw new Error("invalid-parameter")}var tempPublicKey=dataBuf.slice(0,32),ciphertextBuf=dataBuf.slice(32);var sharedsecret=_computeSecret(tempPublicKey);var decryptor=new tool.get("cipher.symmetric")().key(sharedsecret);var decryption=decryptor.decrypt(ciphertextBuf);return decryption}return this}var exporter={name:"curve25519",constructor:function(p){return new curve25519Interface(p)}};tool.set("cipher.asymmetric.curve25519",exporter)})(tool);(function(tool){function U8TO32_LE(x,i){return x[i]|(x[i+1]<<8)|(x[i+2]<<16)|(x[i+3]<<24)}function U32TO8_LE(x,i,u){x[i]=u;u>>>=8;x[i+1]=u;u>>>=8;x[i+2]=u;u>>>=8;x[i+3]=u}function ROTATE(v,c){return(v<<c)|(v>>>(32-c))}var Chacha20=function(rounds,key,nonce,counter){this.input=new Uint32Array(16);this._rounds=rounds;this.input[0]=1634760805;this.input[1]=857760878;this.input[2]=2036477234;this.input[3]=1797285236;this.input[4]=U8TO32_LE(key,0);this.input[5]=U8TO32_LE(key,4);this.input[6]=U8TO32_LE(key,8);this.input[7]=U8TO32_LE(key,12);this.input[8]=U8TO32_LE(key,16);this.input[9]=U8TO32_LE(key,20);this.input[10]=U8TO32_LE(key,24);this.input[11]=U8TO32_LE(key,28);if(12==nonce.length){this.input[12]=counter;this.input[13]=U8TO32_LE(nonce,0);this.input[14]=U8TO32_LE(nonce,4);this.input[15]=U8TO32_LE(nonce,8)}else{this.input[12]=counter;this.input[13]=0;this.input[14]=U8TO32_LE(nonce,0);this.input[15]=U8TO32_LE(nonce,4)}};Chacha20.prototype.quarterRound=function(x,a,b,c,d){x[a]+=x[b];x[d]=ROTATE(x[d]^x[a],16);x[c]+=x[d];x[b]=ROTATE(x[b]^x[c],12);x[a]+=x[b];x[d]=ROTATE(x[d]^x[a],8);x[c]+=x[d];x[b]=ROTATE(x[b]^x[c],7)};Chacha20.prototype.encrypt=function(dst,src,len){var x=new Uint32Array(16);var output=new Uint8Array(64);var i,dpos=0,spos=0;while(len>0){for(i=16;i--;){x[i]=this.input[i]}for(i=this._rounds;i>0;i-=2){this.quarterRound(x,0,4,8,12);this.quarterRound(x,1,5,9,13);this.quarterRound(x,2,6,10,14);this.quarterRound(x,3,7,11,15);this.quarterRound(x,0,5,10,15);this.quarterRound(x,1,6,11,12);this.quarterRound(x,2,7,8,13);this.quarterRound(x,3,4,9,14)}for(i=16;i--;){x[i]+=this.input[i]}for(i=16;i--;){U32TO8_LE(output,4*i,x[i])}this.input[12]+=1;if(!this.input[12]){this.input[13]+=1}if(len<=64){for(i=len;i--;){dst[i+dpos]=src[i+spos]^output[i]}return}for(i=64;i--;){dst[i+dpos]=src[i+spos]^output[i]}len-=64;spos+=64;dpos+=64}};Chacha20.prototype.keystream=function(dst,len){for(var i=0;i<len;++i){dst[i]=0}this.encrypt(dst,dst,len)};Chacha20.prototype.seek=function(u32_0,u32_1){this.input[12]=u32_0;this.input[13]=u32_1};function ChaCha20Interface(rounds,testing){var self=this;var cipher=null;function _xorBuf(dataBuf){if(!tool.get("util.type")(dataBuf).isArrayBuffer()){throw new Error("invalid-input")}var data=new Uint8Array(dataBuf),ret=new Uint8Array(data.length);cipher.encrypt(ret,data,data.length);return ret.buffer}this.key=function(bufKey){if(!tool.get("util.type")(bufKey).isArrayBuffer()){throw new Error("invalid-key")}var keylen=bufKey.byteLength;if(keylen<24){throw new Error("invalid-key")}var nonceAry=new Uint8Array(bufKey.slice(0,8));var keyAry=null;if(keylen<40){keyAry=new Uint8Array(bufKey.slice(8,24))}else{keyAry=new Uint8Array(bufKey.slice(8,40))}cipher=new Chacha20(rounds,keyAry,nonceAry);self.encrypt=_xorBuf;self.decrypt=_xorBuf;self.seek=cipher.seek;delete self.key;return self};return this}var exporter={name:"ChaCha20/20",constructor:function(){return new ChaCha20Interface(20)},raw:ChaCha20Interface};tool.set("cipher.symmetric.chacha20",exporter)})(tool);(function(tool){function _Salsa20(rounds,testing){var self=this;var coreFuncX=new Uint32Array(16);function coreFunc(ina,ret){function R(a,b){return(((a)<<(b))|((a)>>>(32-(b))))}var i;var x=coreFuncX;for(i=0;i<16;i++){x[i]=ina[i]}for(i=0;i<rounds;i++){x[4]^=R(x[0]+x[12],7);x[8]^=R(x[4]+x[0],9);x[12]^=R(x[8]+x[4],13);x[0]^=R(x[12]+x[8],18);x[9]^=R(x[5]+x[1],7);x[13]^=R(x[9]+x[5],9);x[1]^=R(x[13]+x[9],13);x[5]^=R(x[1]+x[13],18);x[14]^=R(x[10]+x[6],7);x[2]^=R(x[14]+x[10],9);x[6]^=R(x[2]+x[14],13);x[10]^=R(x[6]+x[2],18);x[3]^=R(x[15]+x[11],7);x[7]^=R(x[3]+x[15],9);x[11]^=R(x[7]+x[3],13);x[15]^=R(x[11]+x[7],18);x[1]^=R(x[0]+x[3],7);x[2]^=R(x[1]+x[0],9);x[3]^=R(x[2]+x[1],13);x[0]^=R(x[3]+x[2],18);x[6]^=R(x[5]+x[4],7);x[7]^=R(x[6]+x[5],9);x[4]^=R(x[7]+x[6],13);x[5]^=R(x[4]+x[7],18);x[11]^=R(x[10]+x[9],7);x[8]^=R(x[11]+x[10],9);x[9]^=R(x[8]+x[11],13);x[10]^=R(x[9]+x[8],18);x[12]^=R(x[15]+x[14],7);x[13]^=R(x[12]+x[15],9);x[14]^=R(x[13]+x[12],13);x[15]^=R(x[14]+x[13],18)}for(i=0;i<16;i++){ret[i]=x[i]+ina[i]}}var _keyExpanBuffer=new Uint32Array(16);function _salsa20BufferFillKey8(nonce2,key8){var input=_keyExpanBuffer,sigma=new Uint32Array([1634760805,857760878,2036477234,1797285236]);input[0]=sigma[0];input[1]=key8[0];input[2]=key8[1];input[3]=key8[2];input[4]=key8[3];input[5]=sigma[1];input[6]=nonce2[0];input[7]=nonce2[1];input[10]=sigma[2];input[11]=key8[4];input[12]=key8[5];input[13]=key8[6];input[14]=key8[7];input[15]=sigma[3]}function _salsa20ExpansionKey8(ret){var input=_keyExpanBuffer;input[8]=counter[0];input[9]=counter[1];return coreFunc(input,ret)}function _salsa20BufferFillKey4(nonce2,key4){var input=_keyExpanBuffer;tau=new Uint32Array([1634760805,824206446,2036477238,1797285236]);input[0]=tau[0];input[1]=key4[0];input[2]=key4[1];input[3]=key4[2];input[4]=key4[3];input[5]=tau[1];input[6]=nonce2[0];input[7]=nonce2[1];input[10]=tau[2];input[11]=key4[0];input[12]=key4[1];input[13]=key4[2];input[14]=key4[3];input[15]=tau[3]}function _salsa20ExpansionKey4(ret){var input=_keyExpanBuffer;input[8]=counter[0];input[9]=counter[1];return coreFunc(input,ret)}var counter=new Uint32Array(2);var blockGenerator;function _counterReset(){counter[0]=0;counter[1]=0}function _counterInc(){counter[0]+=1;if(0==counter[0]){counter[1]+=1}}function _initialize(nonceBuf,keyBuf){var nonce=new Uint32Array(nonceBuf);if(32==keyBuf.byteLength){var key=new Uint32Array(keyBuf);_salsa20BufferFillKey8(nonce,key);blockGenerator=function(ret){_salsa20ExpansionKey8(ret);_counterInc()}}else{if(16==keyBuf.byteLength){var key=new Uint32Array(keyBuf);_salsa20BufferFillKey4(nonce,key);blockGenerator=function(ret){_salsa20ExpansionKey4(ret);_counterInc()}}else{throw new Error("invalid-key-length")}}}function isArrayBuffer(v){return toString.apply(v)==="[object ArrayBuffer]"}function _xorBuf(dataBuf){if(!isArrayBuffer(dataBuf)){throw new Error("invalid-input")}var origLength=dataBuf.byteLength,blocksCount=Math.floor(origLength/64)+1,block=new Uint32Array(16);var stream=new Uint8Array(dataBuf),xorStream=new Uint8Array(stream.length+64);var b=0,i,j;for(i=0;i<blocksCount;i++){blockGenerator(block);for(j=0;j<16;j++){xorStream[b++]=(block[j]>>0)&255;xorStream[b++]=(block[j]>>8)&255;xorStream[b++]=(block[j]>>16)&255;xorStream[b++]=(block[j]>>24)&255}}for(i=0;i<origLength;i++){stream[i]^=xorStream[i]}return stream.buffer}function _seek(u32_0,u32_1){counter[0]=u32_0;counter[1]=u32_1}this.key=function(bufKey){if(!isArrayBuffer(bufKey)){throw new Error("invalid-key")}var keylen=bufKey.byteLength;if(keylen<24){throw new Error("invalid-key")}var nonceBuf=bufKey.slice(0,8);if(keylen<40){_initialize(nonceBuf,bufKey.slice(8,24))}else{_initialize(nonceBuf,bufKey.slice(8,40))}self.encrypt=_xorBuf;self.decrypt=_xorBuf;self.seek=_seek;delete self.key;return self};if(true===testing){this.core=function(inaBuf){var ret=new Uint32Array(16);coreFunc(new Uint32Array(inaBuf),ret);return ret.buffer}}return this}var exporter={name:"Salsa20/20",constructor:function(){return new _Salsa20(20)},raw:_Salsa20};tool.set("cipher.symmetric.salsa20",exporter)})(tool);(function(tool){function NCSC512(){var self=this;var keyBuffer=null;function deriveKey(keyBuf,saltBuf,keyCount){var eachKeyLen=new tool.get("hash")().getOutputBytesLength();var stream=new tool.get("hash")(64).pbkdf2(keyBuf,saltBuf,4,keyCount*eachKeyLen);var result=new Array(keyCount);for(var i=0;i<keyCount;i++){result[i]=new tool.get("hash")(64).hash(stream.slice(i*eachKeyLen,(i+1)*eachKeyLen)).buffer}return result}var encrypt=function(dataBuffer){if(!tool.get("util.type")(dataBuffer).isArrayBuffer()){throw new Error("invalid-parameter")}var saltBuf=new tool.get("util.srand")().bytes(10);var keys=deriveKey(keyBuffer,saltBuf,3);var MAC=new tool.get("hash")(6).mac(dataBuffer,keys[0]).buffer;dataBuffer=tool.get("util.buffer").concat([MAC,dataBuffer]);var result=dataBuffer;result=Salsa20Encrypt(keys[1],result);result=ChaCha20Encrypt(keys[2],result);return tool.get("util.buffer").concat([saltBuf,result])};var decrypt=function(dataBuffer){if(!(tool.get("util.type")(dataBuffer).isArrayBuffer()&&dataBuffer.byteLength>=10)){throw new Error("invalid-parameter")}var salt=dataBuffer.slice(0,10);dataBuffer=dataBuffer.slice(10);var keys=deriveKey(keyBuffer,salt,3);var result=dataBuffer;result=ChaCha20Decrypt(keys[2],result);result=Salsa20Decrypt(keys[1],result);if(!tool.get("util.type")(result).isArrayBuffer()){return null}var gotMAC=result.slice(0,6);result=result.slice(6);var foundMAC=new tool.get("hash")(6).mac(result,keys[0]).buffer;if(tool.get("util.buffer").equal(gotMAC,foundMAC)){return result}return null};this.key=function(keyBuf){if(!tool.get("util.type")(keyBuf).isArrayBuffer()){throw new Error("invalid-key")}keyBuffer=keyBuf;delete self.key;self.encrypt=encrypt;self.decrypt=decrypt;return self};return this}var Salsa20Encrypt=function(key,plaintext){try{var salsa20=tool.get("cipher.symmetric.salsa20").constructor;return salsa20().key(key).encrypt(plaintext)}catch(e){tool.get("util.log").error(e);return new Error("unable-to-encrypt")}};var Salsa20Decrypt=function(key,ciphertext){try{var salsa20=tool.get("cipher.symmetric.salsa20").constructor;return salsa20().key(key).decrypt(ciphertext)}catch(e){tool.get("util.log").error(e);return new Error("unable-to-decrypt",e)}};var ChaCha20Encrypt=function(key,plaintext){try{var chacha20=tool.get("cipher.symmetric.chacha20").constructor;return chacha20().key(key).encrypt(plaintext)}catch(e){tool.get("util.log").error(e);return new Error("unable-to-encrypt")}};var ChaCha20Decrypt=function(key,ciphertext){try{var chacha20=tool.get("cipher.symmetric.chacha20").constructor;return chacha20().key(key).decrypt(ciphertext)}catch(e){tool.get("util.log").error(e);return new Error("unable-to-decrypt",e)}};function exporter(){return new NCSC512()}tool.set("cipher.symmetric",exporter);tool.exp("cipher.symmetric",exporter)})(tool);(function(tool){function abstractMessage(){var self=this;return this}})(tool);(function(tool){var config={defaultAlgorithmName:"NECRAC128",subjectRule:/^[0-9a-z\-_\s]{8,255}$/i};var template={_:["constant",new Uint8Array([69,73]).buffer],subject:"shortBinary",algorithm:["enum","NECRAC128"],"public":"binary",secret:"shortBinary",signature:"binary"};function identity(){var self=this;var hash=tool.get("hash");var buffer=tool.get("util.buffer");var getDef=tool.get("cipher.asymmetric.definition");var testType=tool.get("util.type");var serializer=tool.get("util.serialize")(template);var subjectBuf,secretBuf,publicKeyBuf,algorithmName,signatureBuf,asymCipher;var identityID=false;function getID(){if(identityID){return identityID}identityID=hash().mac(publicKeyBuf,subjectBuf).buffer;return identityID}function initialize(prv){self.exportPublic=exportPublic;self.verify=verify;self.encrypt=encrypt;self.getFingerprint=getFingerprint;self.getHash=getID;self.getSubject=getSubject;self.getAlgorithm=getAlgorithm;if(prv){self.decrypt=decrypt;self.sign=sign;self.exportPrivate=exportPrivate}self.isPrivate=function(){return Boolean(prv)};delete self.generate;delete self.loadPublic;delete self.loadPrivate}this.generate=function(subject,options){if(!options){options={}}if(!config.subjectRule.test(subject)){throw new Error("enigma-invalid-input")}subjectBuf=tool.get("util.encoding")(subject,"ascii").toArrayBuffer();algorithmName=options.algorithm||config.defaultAlgorithmName;var algorithm=getDef(algorithmName);if(!algorithm){algorithmName=defaults.algorithmName;algorithm=getDef(algorithmname)}secretBuf=tool.get("util.srand")().bytes(algorithm.secretLength);asymCipher=tool.get("cipher.asymmetric")(algorithm.name);asymCipher.setPrivateKey(secretBuf);publicKeyBuf=asymCipher.getPublicKey();signatureBuf=asymCipher.sign(getID());initialize(true)};function loadIdentityBuf(buf,pinkeyBuf){if(!testType(buf).isArrayBuffer()){throw new Error("enigma-invalid-input")}if(pinkeyBuf&&!testType(pinkeyBuf).isArrayBuffer()){throw new Error("enigma-invalid-input")}try{var d=serializer.deserialize(buf)}catch(e){throw new Error("enigma-invalid-input")}var dSubjectBuf=d.subject,dAlgorithmName=d.algorithm,dSignatureBuf=d.signature,dPublicBuf=d["public"],dSecretBuf=d.secret;if(!config.subjectRule.test(tool.get("util.encoding")(dSubjectBuf).toASCII())){throw new Error("enigma-invalid-input")}subjectBuf=dSubjectBuf;algorithmName=dAlgorithmName;signatureBuf=dSignatureBuf;publicKeyBuf=dPublicBuf;asymCipher=tool.get("cipher.asymmetric")(algorithmName);if(pinkeyBuf){try{secretBuf=tool.get("cipher.symmetric")().key(pinkeyBuf).decrypt(dSecretBuf)}catch(e){throw new Error("enigma-invalid-pinkey")}asymCipher.setPrivateKey(secretBuf);var derivedPublicKey=asymCipher.getPublicKey();if(!tool.get("util.buffer").equal(derivedPublicKey,publicKeyBuf)){throw new Error("enigma-identity-inconsistent")}}else{asymCipher.setPublicKey(publicKeyBuf)}try{var selfSigVerify=asymCipher.verify(getID(),signatureBuf);if(!selfSigVerify){throw new Error("enigma-identity-bad-self-signature")}}catch(e){throw new Error("enigma-identity-bad-self-signature")}return true}this.loadPublic=function(publicIdentityBuf){if(loadIdentityBuf(publicIdentityBuf)){initialize(false)}};this.loadPrivate=function(secretIdentityBuf,pinkeyBuf){if(loadIdentityBuf(secretIdentityBuf,pinkeyBuf)){initialize(true)}};this.canLoadPrivate=function(testIdentityBuf){if(!testType(testIdentityBuf).isArrayBuffer()){throw new Error("enigma-invalid-input")}try{var d=serializer.deserialize(testIdentityBuf)}catch(e){throw new Error("enigma-invalid-input")}return Boolean(null!=d.secret)};function getSubject(){return tool.get("util.encoding")(subjectBuf).toASCII()}function getAlgorithm(){return algorithmName}function getFingerprint(useStrFormat){var fp=getID().slice(0,10);if(useStrFormat){return tool.get("util.encoding")(fp).toBase32()}return fp}function exportPublic(){var ret=serializer.serialize({subject:subjectBuf,algorithm:algorithmName,"public":publicKeyBuf,secret:new Uint8Array(0).buffer,signature:signatureBuf});return ret}function exportPrivate(pinkeyBuf){if(!(testType(pinkeyBuf).isArrayBuffer()&&pinkeyBuf.byteLength>=32)){throw new Error("enigma-invalid-pinkey")}var secretEncryptedBuf=tool.get("cipher.symmetric")().key(pinkeyBuf).encrypt(secretBuf);var ret=serializer.serialize({subject:subjectBuf,algorithm:algorithmName,"public":publicKeyBuf,secret:secretEncryptedBuf,signature:signatureBuf});return ret}function verify(plaintext,signature){if(!(testType(plaintext).isArrayBuffer()&&testType(signature).isArrayBuffer())){throw new Error("enigma-invalid-input")}try{return true===asymCipher.verify(plaintext,signature)}catch(e){return false}}function sign(plaintext){if(!testType(plaintext).isArrayBuffer()){throw new Error("enigma-invalid-input")}try{return asymCipher.sign(plaintext)}catch(e){throw new Error("enigma-identity-unable-to-sign")}}function encrypt(plaintext){if(!testType(plaintext).isArrayBuffer()){throw new Error("enigma-invalid-input")}try{return asymCipher.encrypt(plaintext)}catch(e){throw new Error("enigma-identity-unable-to-encrypt")}}function decrypt(ciphertext){if(!testType(ciphertext).isArrayBuffer()){throw new Error("enigma-invalid-input")}try{return asymCipher.decrypt(ciphertext)}catch(e){throw new Error("enigma-identity-unable-to-decrypt")}}return this}var exporter=function(){return new identity()};tool.set("enigma.identity",exporter);tool.exp("enigma.identity",exporter)})(tool);(function(tool){var templatePayload={_:["constant",new Uint8Array([69,112]).buffer],signers:"shortArray",signatures:"array",content:"longBinary"};var templateEnvelope={_:["constant",new Uint8Array([69,67]).buffer],compression:["enum",false,"lzw"],receivers:"shortArray",decryptors:"array",payload:"longBinary"};function message(){var self=this;var testType=tool.get("util.type");var payloadSerializer=tool.get("util.serialize")(templatePayload),envelopeSerializer=tool.get("util.serialize")(templateEnvelope);var plaintextBuf,mainKeyBuf,receivers=[],decryptors=[],signatures=[],signers=[],clearSign=false;var payloadBuf,payloadCompression;this.write=function(plaintext,options){if(!testType(plaintext).isArrayBuffer()){throw new Error("enigma-invalid-input")}plaintextBuf=plaintext;mainKeyBuf=new tool.get("util.srand")().bytes(64);clearSign=(options&&true===options.clearsign);delete self.write;delete self.read;self.sign=sign;if(!clearSign){self.encrypt=encrypt}};this.read=function(textBuf){if(!testType(textBuf).isArrayBuffer()){throw new Error("enigma-invalid-input")}var isEnvelope=true;try{var envelopeDeserialized=envelopeSerializer.deserialize(textBuf)}catch(e){isEnvelope=false}if(isEnvelope){var dReceivers=envelopeDeserialized.receivers,dDecryptors=envelopeDeserialized.decryptors,dCompression=envelopeDeserialized.compression,dPayload=envelopeDeserialized.payload;payloadBuf=dPayload;payloadCompression=dCompression;if(dReceivers.length!=dDecryptors.length){throw new Error("enigma-invalid-input")}if(dReceivers.length>0){decryptors=dDecryptors;receivers=dReceivers;self.decrypt=decrypt;self.getReceivers=getReceivers;delete self.write;delete self.read;return}}else{payloadCompression=false;payloadBuf=textBuf}continueUnpackPayload();delete self.write;delete self.read};function continueUnpackPayload(){if("lzw"==payloadCompression){try{payloadBuf=tool.get("util.decompress")(payloadBuf)}catch(e){throw new Error("enigma-invalid-input")}}else{if(false!==payloadCompression){throw new Error("enigma-invalid-input")}}try{var payloadDeserialized=payloadSerializer.deserialize(payloadBuf)}catch(e){throw new Error("enigma-invalid-input")}var dSignatures=payloadDeserialized.signatures,dSigners=payloadDeserialized.signers,dPlaintext=payloadDeserialized.content;if(dSignatures.length!=dSigners.length){throw new Error("enigma-invalid-input")}plaintextBuf=dPlaintext;self.getPlaintext=getPlaintext;if(dSigners.length>0){signatures=dSignatures;signers=dSigners;self.verify=verify;self.getSigners=getSigners}}function sign(withIdentity){if(!withIdentity.isPrivate()){throw new Error("enigma-invalid-identity-for-sign")}var withIdentityFp=withIdentity.getFingerprint();var signature=withIdentity.sign(plaintextBuf);signers.push(withIdentityFp);signatures.push(signature);if(signers.length>=255){delete self.sign}if(undefined==self.done){self.done=done}}function encrypt(toIdentity){var decryptor=toIdentity.encrypt(mainKeyBuf);var toIdentityFp=toIdentity.getFingerprint();receivers.push(toIdentityFp);decryptors.push(decryptor);if(receivers.length>=255){delete self.encrypt}if(undefined==self.done){self.done=done}return true}function done(){delete self.sign;delete self.encrypt;var payloadBuf=payloadSerializer.serialize({signers:signers,signatures:signatures,content:plaintextBuf});if(clearSign){return payloadBuf}var compress="lzw";if(compress){payloadBuf=tool.get("util.compress")(payloadBuf)}var encrypt=(decryptors.length>0);if(encrypt){payloadBuf=tool.get("cipher.symmetric")().key(mainKeyBuf).encrypt(payloadBuf)}var envelopeBuf=envelopeSerializer.serialize({compression:compress||false,receivers:receivers,decryptors:decryptors,payload:payloadBuf});delete self.done;return envelopeBuf}function decrypt(withIdentity){if(!withIdentity.isPrivate()){throw new Error("enigma-invalid-public-identity-for-decrypt")}var identityFingerprint=withIdentity.getFingerprint(),found=false;for(var i=0;i<receivers.length;i++){if(tool.get("util.buffer").equal(identityFingerprint,receivers[i])){found=true;break}}if(!found){throw new Error("enigma-not-intended-identity-for-decrypt")}var decryptor=decryptors[i];try{var mainKeyBuf=withIdentity.decrypt(decryptor)}catch(e){throw new Error("enigma-identity-decryption-error")}try{payloadBuf=tool.get("cipher.symmetric")().key(mainKeyBuf).decrypt(payloadBuf)}catch(e){throw new Error("enigma-message-corrupted")}continueUnpackPayload(payloadBuf);delete self.decrypt;delete self.getReceivers}function verify(withIdentity){var identityFingerprint=withIdentity.getFingerprint(),found=false;for(var i=0;i<signers.length;i++){if(tool.get("util.buffer").equal(identityFingerprint,signers[i])){found=true;break}}if(!found){throw new Error("enigma-invalid-identity-for-verify")}var signature=signatures[i];try{return withIdentity.verify(plaintextBuf,signature)}catch(e){throw new Error("enigma-invalid-identity-for-verify")}}function getPlaintext(){return plaintextBuf}function _fpListToStr(l){var ret=[];for(var i in l){ret.push(tool.get("util.encoding")(l[i]).toBase32())}return ret}function getReceivers(){return _fpListToStr(receivers)}function getSigners(){return _fpListToStr(signers)}return this}function exporter(){return new message()}tool.set("enigma.message",exporter);tool.exp("enigma.message",exporter)})(tool);(function(tool){function getTaskList(_storage,log){var list=[];list.push(function askFingerprint(){return{question:"text.fingerprint"}});list.push(function doer(data,answers){log("Operation - delete identity, received.");var storage=tool.get("enigma.interface.storage")(_storage),fingerprint=answers["text.fingerprint"];var get=storage.value(fingerprint);if(null==get){return{terminate:true,error:"identity-not-found"}}storage.remove(fingerprint);log("Identity ["+fingerprint+"] is deleted.");return{terminate:fingerprint}});return list}var exporter={variables:{"text.fingerprint":{type:"string",validate:function(v){return/^[0-9a-z]+$/i.test(v)}}},errors:["identity-not-found"],constructor:function(storage,log){return getTaskList(storage,log)}};tool.set("enigma.interface.api.identity-delete",exporter)})(tool);(function(tool){function getTaskList(_storage,log){var list=[];list.push(function askFingerprint(){return{data:{},question:"text.fingerprint"}});list.push(function checkIfPrivate(data,answers){var storage=tool.get("enigma.interface.storage")(_storage);var fingerprint=answers["text.fingerprint"];var isPrivate=storage.note(fingerprint,"isPrivate");if(null===isPrivate){return{terminate:true,error:"identity-not-found"}}data.isPrivate=isPrivate;if(!isPrivate){return{data:data,jump:"doer"}}return{data:data}});list.push(function askIfIncludePrivate(){return{question:"option.include-private"}});list.push(function determineAskPassphrase(data,answers){if(!answers["option.include-private"]){return{jump:"doer"}}return{}});list.push(function askPassphrase(){return{question:"text.passphrase"}});list.push(function askSavePassphrase(){return{question:"text.save-passphrase"}});list.push(function doer(data,answers){log("Operation - export identity, received.");var storage=tool.get("enigma.interface.storage")(_storage),fingerprint=answers["text.fingerprint"];var get=storage.value(fingerprint);var loadPrivate=true,passphraseBuf,savePassphraseBuf;if(false===data.isPrivate){loadPrivate=false}else{if(!answers["option.include-private"]){loadPrivate=false}else{passphraseBuf=tool.get("util.encoding")(answers["text.passphrase"],"ascii").toArrayBuffer();savePassphraseBuf=tool.get("util.encoding")(answers["text.save-passphrase"],"ascii").toArrayBuffer()}}if(null==get){return{terminate:true,error:"identity-not-found"}}try{var identitySerializedBuf=tool.get("util.encoding")(get,"base64").toArrayBuffer();var identity=tool.get("enigma.identity")();console.log(get);if(loadPrivate){log("Private identity is being read.");identity.loadPrivate(identitySerializedBuf,passphraseBuf)}else{log("Public identity is being read.");identity.loadPublic(identitySerializedBuf)}}catch(e){console.log(e);return{error:"identity-could-not-be-loaded",terminate:true}}if(loadPrivate){var exportBuf=identity.exportPrivate(savePassphraseBuf)}else{var exportBuf=identity.exportPublic()}var exportHEX=tool.get("util.encoding")(exportBuf).toHEX();return{terminate:exportHEX}});return list}var exporter={variables:{"text.fingerprint":{type:"string",validate:function(v){return/^[0-9a-z]+$/i.test(v)}},"text.passphrase":{type:"string",validate:function(v){return/^[\x20-\x7E]{32,}$/.test(v)}},"text.save-passphrase":{type:"string",validate:function(v){return/^[\x20-\x7E]{32,}$/.test(v)}},"option.include-private":"boolean"},errors:["identity-not-found","identity-could-not-be-loaded"],constructor:function(storage,log){return getTaskList(storage,log)}};tool.set("enigma.interface.api.identity-export",exporter)})(tool);(function(tool){function getTaskList(_storage,log){var list=[];list.push(function askSubject(){return{question:"text.subject"}});list.push(function askAlgorithm(){return{question:"select.algorithm"}});list.push(function askPassphrase(){return{question:"text.passphrase"}});list.push(function generateIdentity(data,answer){var storage=tool.get("enigma.interface.storage")(_storage);var newIdentity=tool.get("enigma.identity")(),passphrase=tool.get("util.encoding")(answer["text.passphrase"],"ascii").toArrayBuffer();newIdentity.generate(answer["text.subject"],{algorithm:answer["select.algorithm"]});var newFingerprint=newIdentity.getFingerprint(true),newIdentitySerializedBuf=newIdentity.exportPrivate(passphrase);var newIdentitySerializedB64=tool.get("util.encoding")(newIdentitySerializedBuf).toBase64();storage.value(newFingerprint,newIdentitySerializedB64);storage.note(newFingerprint,"subject",answer["text.subject"]);storage.note(newFingerprint,"isPrivate",true);storage.note(newFingerprint,"algorithm",answer["select.algorithm"]);return{terminate:newFingerprint}});return list}var exporter={variables:{"text.subject":{type:"string",validate:function(v){return/^[0-9a-z\s]{8,255}$/i.test(v)}},"text.passphrase":{type:"string",validate:function(v){return/^[\x20-\x7E]{32,}$/.test(v)}},"select.algorithm":["enum",["NECRAC256","NECRAC192","NECRAC128","NECRAC112","NECRAC96"]]},errors:[],constructor:function(storage,log){return getTaskList(storage,log)}};tool.set("enigma.interface.api.identity-generate",exporter)})(tool);(function(tool){function getTaskList(_storage,log){var list=[];list.push(function askIdentityData(){return{question:"text.data"}});list.push(function decodeIdentityData(data,answer){var decoder=tool.get("util.encoding")(answer["text.data"],"hex");data.identityBuf=decoder.toArrayBuffer();return{data:data}});list.push(function readIdentity(data,answer){var isPrivate=false,identity=tool.get("enigma.identity")();try{isPrivate=identity.canLoadPrivate(data.identityBuf)}catch(e){console.error(e);return{error:"identity-could-not-be-loaded",terminate:true}}if(!isPrivate){return{data:{isPrivate:false},jump:"loadIdentity"}}return{data:{isPrivate:true}}});list.push(function askIdentityReadPassphrase(){return{question:"text.read-passphrase"}});list.push(function loadIdentity(data,answer){var newdata={};newdata.identity=tool.get("enigma.identity")();try{if(data.isPrivate){var pinkeyBuf=tool.get("util.encoding")(answer["text.read-passphrase"],"ascii").toArrayBuffer();newdata.identity.loadPrivate(data.identityBuf,pinkeyBuf)}else{newdata.identity.loadPublic(data.identityBuf)}}catch(e){if("enigma-invalid-pinkey"==e.message){return{error:"identity-could-not-be-loaded",jump:"askIdentityReadPassphrase"}}if("enigma-identity-invalid"==e.message){return{error:"invalid-identity",terminate:true}}return{error:"identity-could-not-be-loaded",terminate:true}}if(!data.isPrivate){return{data:newdata,jump:"saveIdentity"}}return{data:newdata}});list.push(function askPassphrase(){return{question:"text.passphrase"}});list.push(function saveIdentity(data,answer){var storage=tool.get("enigma.interface.storage")(_storage);var fingerprint=data.identity.getFingerprint(true);if(data.isPrivate){var passphraseBuf=tool.get("util.encoding")(answer["text.passphrase"],"ascii").toArrayBuffer();var identityBuf=data.identity.exportPrivate(passphraseBuf)}else{var identityBuf=data.identity.exportPublic()}var identityB64=tool.get("util.encoding")(identityBuf).toBase64();storage.value(fingerprint,identityB64);storage.note(fingerprint,"subject",data.identity.getSubject());storage.note(fingerprint,"isPrivate",data.isPrivate);storage.note(fingerprint,"algorithm",data.identity.getAlgorithm());return{terminate:fingerprint}});return list}var exporter={variables:{"text.data":{type:"string",validate:function(v){return(0==v.length%2)&&/^[0-9a-f]+$/i.test(v)}},"text.passphrase":{type:"string",validate:function(v){return/^[\x20-\x7E]{32,}$/.test(v)}},"text.read-passphrase":{type:"string",validate:function(v){return/^[\x20-\x7E]{32,}$/.test(v)}}},errors:["identity-could-not-be-loaded","invalid-identity"],constructor:function(storage,log){return getTaskList(storage,log)}};tool.set("enigma.interface.api.identity-import",exporter)})(tool);(function(tool){function getTaskList(_storage,log){var list=[];list.push(function askOptionIncludePrivate(){return{question:"option.list-private-identities-only"}});list.push(function askOptionIncludePublic(){return{question:"option.filter-by-keywords"}});list.push(function doer(data,answers){log("Operation - listing identity, received.");if(answers["option.list-private-identities-only"]){log("The list will ONLY include private identities.")}log("Following keywords will be used to filter the subject:\n "+answers["option.filter-by-keywords"]);var filter=false;if(answers["option.filter-by-keywords"]){filter=answers["option.filter-by-keywords"].toLowerCase().split(" ")}var storage=tool.get("enigma.interface.storage")(_storage),listAllFingerprints=storage.all();var ret={},fingerprint,subject,isPrivate,algorithm;var subjectLow,filtered=false;for(var i in listAllFingerprints){fingerprint=listAllFingerprints[i];isPrivate=storage.note(fingerprint,"isPrivate");subject=storage.note(fingerprint,"subject");algorithm=storage.note(fingerprint,"algorithm");if(answers["option.list-private-identities-only"]&&!isPrivate){continue}if(filter){subjectLow=subject.toLowerCase();filtered=false;for(var j in filter){if(!filter[j]){continue}if(subjectLow.indexOf(filter[j])<0){filtered=true;break}}if(filtered){continue}}ret[fingerprint]={"private":isPrivate,subject:subject,fingerprint:fingerprint,algorithm:algorithm}}return{terminate:ret}});return list}var exporter={variables:{"option.list-private-identities-only":"boolean","option.filter-by-keywords":"string"},errors:["option-results-in-empty-return"],constructor:function(storage,log){return getTaskList(storage,log)}};tool.set("enigma.interface.api.identity-list",exporter)})(tool);(function(tool){tool.set("enigma.interface.api.message.common.loadIdentity",function(s,fingerprint,pinKey){var storage=tool.get("enigma.interface.storage")(s);var buf=storage.value(fingerprint),isPrivate=storage.note(fingerprint,"isPrivate")||false;if(!buf){return false}if(!isPrivate&&pinKey){return false}buf=tool.get("util.encoding")(buf,"base64").toArrayBuffer();var ret=tool.get("enigma.identity")();try{if(isPrivate&&pinKey){ret.loadPrivate(buf,pinKey)}else{ret.loadPublic(buf)}}catch(e){console.error("unable to load this identity");console.error(e);return false}return ret})})(tool);(function(tool){function getTaskList(_storage,log){var list=[];list.push(function askRawData(){return{question:"text.data"}});list.push(function prepareMessage(data,answer){var dataBuf=tool.get("util.encoding")(answer["text.data"],"hex").toArrayBuffer();data.message=tool.get("enigma.message")();try{data.message.read(dataBuf)}catch(e){return{error:"unable-to-read-message",terminate:true}}return{data:data}});list.push(function tryDecrypt(data,answer){if(undefined==data.message.decrypt){return{jump:"tryVerify"}}log("Decryption needed.");var storage=tool.get("enigma.interface.storage")(_storage);var receivers=data.message.getReceivers();var fingerprint;var tryIdentities=[];for(var i in receivers){if(!/^[0-9a-z]+$/i.test(receivers[i])){continue}fingerprint=receivers[i];if(true!=storage.note(fingerprint,"isPrivate")){continue}tryIdentities.push(fingerprint)}return{data:{decrypt:tryIdentities}}});list.push(function askDecryptPassphrase(data,answer){if(data.decrypt.length<1){log("No more identity to try for decryption. End.");return{error:"no-identity-to-decrypt",terminate:true}}var storage=tool.get("enigma.interface.storage")(_storage);log("Try to decrypt with identity, fingerprint="+data.decrypt[0]);return{question:"text.passphrase",hint:{fingerprint:data.decrypt[0],subject:storage.note(data.decrypt[0],"subject")}}});list.push(function doDecryptWithPassphrase(data,answer){var identityLoader=tool.get("enigma.interface.api.message.common.loadIdentity");try{var identity=identityLoader(_storage,data.decrypt[0],tool.get("util.encoding")(answer["text.passphrase"],"ascii").toArrayBuffer());if(!identity){return{error:"unable-to-load-identity",jump:"askDecryptPassphrase"}}}catch(e){return{error:"unable-to-load-identity",jump:"askDecryptPassphrase"}}try{data.message.decrypt(identity)}catch(e){if("enigma-message-corrupted"==e.message){return{error:"message-corrupted",terminate:true}}else{data.decrypt.shift();return{data:{decrypt:data.decrypt},jump:"askDecryptPassphrase",error:"wrong-identity-to-decrypt"}}}return{}});list.push(function tryVerify(data,answer){if(undefined==data.message.verify){log("Verification jumped, reason: no signature found.");return{data:{verify:{}},jump:"doer"}}log("Verification possible.");var identityLoader=tool.get("enigma.interface.api.message.common.loadIdentity");var result={};var signers=data.message.getSigners();for(var i in signers){result[signers[i]]=false;try{var identity=identityLoader(_storage,signers[i],false);if(!identity){continue}}catch(e){continue}try{if(true===data.message.verify(identity)){result[signers[i]]=true}}catch(e){}}return{data:{verify:result}}});list.push(function doer(data,answer){var ret={};ret.plaintext=tool.get("util.encoding")(data.message.getPlaintext()).toHEX();ret.verify=data.verify;return{terminate:ret}});return list}var exporter={variables:{"text.data":{type:"string",validate:function(v){return 0==v.length%2&&/^[0-9a-f]+$/i.test(v)}},"text.passphrase":{type:"string",validate:function(v){return/^[\x20-\x7E]{32,}$/.test(v)}}},errors:["unable-to-read-message","unable-to-load-identity","no-identity-to-decrypt","message-corrupted","wrong-identity-to-decrypt"],constructor:function(storage,log){return getTaskList(storage,log)}};tool.set("enigma.interface.api.message-read",exporter)})(tool);(function(tool){function getTaskList(_storage,log){var list=[];list.push(function askRawData(){return{question:"text.data"}});list.push(function prepareMessage(data,answer){var dataBuf=tool.get("util.encoding")(answer["text.data"],"hex").toArrayBuffer();data.message=tool.get("enigma.message")();data.message.write(dataBuf);return{data:data}});list.push(function askAddEncrypt(){return{question:"option.add-encrypt"}});list.push(function askEncryptToFingerprint(data,answer){if(!answer["option.add-encrypt"]){return{jump:"askAddSign"}}return{question:"text.fingerprint"}});list.push(function addEncrypt(data,answer){var identityLoader=tool.get("enigma.interface.api.message.common.loadIdentity");try{var identity=identityLoader(_storage,answer["text.fingerprint"],false);if(!identity){return{error:"unable-to-load-identity",jump:"askAddEncrypt"}}}catch(e){console.error(e);return{error:"unable-to-load-identity",jump:"askAddEncrypt"}}try{data.message.encrypt(identity)}catch(e){return{error:"unable-to-encrypt-using-this-identity",jump:"askAddEncrypt"}}return{jump:"askAddEncrypt"}});list.push(function askAddSign(){return{question:"option.add-sign"}});list.push(function askSignWithFingerprint(data,answer){if(!answer["option.add-sign"]){return{jump:"doer"}}return{question:"text.fingerprint"}});list.push(function askSignWithPassphrase(data,answer){return{question:"text.passphrase"}});list.push(function addSign(data,answer){var identityLoader=tool.get("enigma.interface.api.message.common.loadIdentity");try{var identity=identityLoader(_storage,answer["text.fingerprint"],tool.get("util.encoding")(answer["text.passphrase"],"ascii").toArrayBuffer());if(!identity){return{error:"unable-to-load-identity",jump:"askAddSign"}}}catch(e){console.log(e);return{error:"unable-to-load-identity",jump:"askAddSign"}}try{data.message.sign(identity)}catch(e){return{error:"unable-to-sign-using-this-identity",jump:"askAddSign"}}return{jump:"askAddSign"}});list.push(function doer(data,answer){if(undefined==data.message.done){return{error:"nothing-to-do",terminate:true}}var result=data.message.done();var resultHEX=tool.get("util.encoding")(result).toHEX();return{terminate:resultHEX}});return list}var exporter={variables:{"text.data":{type:"string",validate:function(v){return 0==v.length%2&&/^[0-9a-f]+$/i.test(v)}},"option.add-encrypt":"boolean","option.add-sign":"boolean","text.fingerprint":{type:"string",validate:function(v){return/^[0-9a-z]+$/i.test(v)}},"text.passphrase":{type:"string",validate:function(v){return/^[\x20-\x7E]{32,}$/.test(v)}}},errors:["unable-to-load-identity","unable-to-encrypt-using-this-identity","unable-to-sign-using-this-identity","nothing-to-do"],constructor:function(storage,log){return getTaskList(storage,log)}};tool.set("enigma.interface.api.message-write",exporter)})(tool);(function(tool){var loadAPI=["identity-list","identity-generate","identity-import","identity-export","identity-delete","message-write","message-read"];function procedure(taskList,translator,validator,variableTypes,errorList){var self=this;var index={};var type=tool.get("util.type");var regexp=/^function\s([0-9a-z\_]+)\(/i,regexec,funcname;for(var i in taskList){if(!type(taskList[i]).isFunction()){throw new Error("Non function defined.")}regexec=regexp.exec(taskList[i].toString());if(!regexec){continue}funcname=regexec[1];index[funcname]=i}var callbacks={error:[],question:[],terminated:[]};this.onError=function(callback){callbacks.error.push(callback)};this.onQuestion=function(callback){callbacks.question.push(callback)};this.onTerminated=function(callback){callbacks.terminated.push(callback)};function emit(type,a,b){for(var i in callbacks[type]){callbacks[type][i](a,b)}}var preassigned={};this.assign=function(n,v){preassigned[n]=v;return self};var cancelled=false;var pointer=0,previousData={},gotAnswers={};function shift(){delete self.answer;delete self.cancel;if(pointer>=taskList.length||cancelled){return emit("terminated",previousData)}var result=taskList[pointer](previousData,gotAnswers);if(!type(result).isObject()){throw new Error("Result is not an object.")}if(type(result.data).isObject()){for(var key in result.data){previousData[key]=result.data[key]}}if(result.error){if(errorList.indexOf(result.error)<0){throw new Error("Undeclared error being thrown.")}var error={id:result.error,description:translator.error(result.error)};emit("error",error)}if(result.jump){var dest=index[result.jump];if(!dest){throw new Error("Jump destination unknown.")}pointer=dest;shift()}else{if(result.question){if(!variableTypes[result.question]){throw new Error("Undeclared question being asked.")}if(preassigned[result.question]){if(validator(result.question,preassigned[result.question])){gotAnswers[result.question]=preassigned[result.question];pointer++;shift();return}}var question={id:result.question,description:translator.question(result.question),type:variableTypes[result.question],hint:result.hint||undefined};(function(questionID){self.validate=function(ans){return validator(questionID,ans)};self.answer=function(ans){if(!validator(questionID,ans)){emit("question",question);return false}gotAnswers[questionID]=ans;pointer++;shift();return true};self.cancel=function(){cancelled=true;shift()}})(result.question);emit("question",question)}else{if(undefined!==result.terminate){emit("terminated",result.terminate)}else{pointer++;shift()}}}}this.start=function(){delete self.onError;delete self.onQuestion;delete self.onTerminated;delete self.assign;delete self.start;shift()};return this}function initializer(options){var translator=options.translator,storage=options.storage;if(!(translator&&storage)){throw new Error("Missing components for initialization.")}return function(apiName){var type=tool.get("util.type");if(loadAPI.indexOf(apiName)<0){throw new Error("Unknown API")}var api=tool.get("enigma.interface.api."+apiName);if(!api){throw new Error("API not exists or not loaded.")}var variables=api.variables,errors=api.errors;var variableTypes={};for(var i in variables){if(type(variables[i]).isString()){variableTypes[i]=variables[i]}else{if(type(variables[i]).isArray()){variableTypes[i]=variables[i][0]}else{variableTypes[i]=variables[i].type}}}var validator=function(name,value){var desc=variables[name];function isType(t,value){if("string"===t){return type(value).isString()}else{if("boolean"===t){return type(value).isBoolean()}else{if("number"===t){return type(value).isNumber()}else{if("date"===t){return type(value).isDate()}else{if(type(t).isArray()){if("enum"==t[0]){return t[1].indexOf(value)>=0}}}}}}throw new Error("Unknown type descriptor")}var typeTest=type(desc);if(typeTest.isString()||typeTest.isArray()){return isType(desc,value)}if(typeTest.isObject()){if(!isType(desc.type,value)){return false}if(!desc.validate(value)){return false}return true}throw new Error("Unknown variable descriptor")};var logStart=new Date().getTime();var log=function(text){var time=(new Date().getTime()-logStart)/1000;console.log("["+apiName+"]["+time+"] "+text)};var taskList=api.constructor(storage,log);var session=new procedure(taskList,translator,validator,variableTypes,errors);return session}}tool.exp("enigma.interface",initializer)})(tool);(function(tool){function wrapper(storage){var self=this;function listAll(prefix){var ret=[],key;for(var i=0;i<storage.length;i++){key=storage.key(i);if(prefix===key.slice(0,prefix.length)){ret.push(key.slice(prefix.length))}}return ret}this.all=function(){return listAll("value.")};function operator(mappedKey,data){if(undefined===data){try{return JSON.parse(storage.getItem(mappedKey))}catch(e){return null}}else{if(null===data){storage.removeItem(mappedKey);return self}else{console.log("data set:",mappedKey,JSON.stringify(data));storage.setItem(mappedKey,JSON.stringify(data));return self}}}this.remove=function(key){if(!/^[0-9a-z\-_]+$/i.test(key)){throw new Error("Invalid key")}self.value(key,null);var prefix="note."+key+".";var notes=listAll(prefix);for(var i=0;i<notes.length;i++){operator(prefix+notes[i],null)}};this.value=function(key,data){if(!/^[0-9a-z\-_]+$/i.test(key)){throw new Error("Invalid key")}var mappedKey="value."+key;return operator(mappedKey,data)};this.note=function(key,noteKey,data){if(!/^[0-9a-z\-_]+$/i.test(key)){throw new Error("Invalid key")}if(!/^[0-9a-z\-_]+$/i.test(noteKey)){throw new Error("Invalid note key")}var mappedKey="note."+key+"."+noteKey;return operator(mappedKey,data)};return this}tool.set("enigma.interface.storage",function(p){return new wrapper(p)})})(tool);(function(tool){var supportEnhancement=(("undefined"!==typeof ENIGMA_ENHANCEMENT)&&("undefined"!==typeof ENIGMA_ENHANCEMENT.getRandomBytes));if(supportEnhancement){tool.acc("util.srand.getRandomBytes",function(n){return ENIGMA_ENHANCEMENT.getRandomBytes(n)})}})(tool);(function(tool){if(!tool.get("env.isNode")){return}try{var createHash=require("crypto").createHash,buffer=require("buffer")}catch(e){return}var supportWhirlpool=true;try{createHash("whirlpool")}catch(e){supportWhirlpool=false}if(supportWhirlpool){tool.acc("hash.algorithms.whirlpool",function(){var self=this;this.name="WHIRLPOOL";this.blockSize=64;this.digestSize=64;this.hash=function(dataBuf){var hasher=createHash("whirlpool");hasher.update(new buffer.Buffer(new Uint8Array(dataBuf)));var ret=hasher.digest(),retary=new Uint8Array(ret.length);for(var i=0;i<retary.length;i++){retary[i]=ret[i]}return retary.buffer};return this})}})(tool);(function(tool){var chacha20=tool.get("cipher.symmetric.chacha20").raw;var assureBuf=function(v){if(tool.get("util.type")(v).isArrayBuffer()){return v}return tool.get("util.encoding")(v,"hex").toArrayBuffer()};function testExpansion(rounds,nonceBuf,keyBuf,assertBuf){nonceBuf=assureBuf(nonceBuf);keyBuf=assureBuf(keyBuf);assertBuf=assureBuf(assertBuf);var nonceAry=new Uint8Array(nonceBuf);var keyAry=new Uint8Array(keyBuf);var input=new Uint8Array(8+keyAry.length);for(var i=0;i<8;i++){input[i]=nonceAry[i]}for(var i=0;i<keyAry.length;i++){input[i+8]=keyAry[i]}var cipher=new chacha20(rounds,true).key(input.buffer);if(nonceBuf.byteLength>8){var counterAry=new Uint32Array(nonceBuf.slice(8,16));cipher.seek(counterAry[0],counterAry[1])}var ret=cipher.encrypt(assertBuf);return tool.get("util.buffer").equal(ret,new Uint8Array(ret.byteLength).buffer)}function doChaChaTest(){var result={};result["draft-12-256-1"]=testExpansion(12,"0000000000000000","0000000000000000000000000000000000000000000000000000000000000000","9bf49a6a0755f953811fce125f2683d50429c3bb49e074147e0089a52eae155f0564f879d27ae3c02ce82834acfa8c793a629f2ca0de6919610be82f411326be0bd58841203e74fe86fc71338ce0173dc628ebb719bdcbcc151585214cc089b442258dcda14cf111c602b8971b8cc843");result["draft-12-256-2"]=testExpansion(12,"0000000000000000","0100000000000000000000000000000000000000000000000000000000000000","12056e595d56b0f6eef090f0cd25a20949248c2790525d0f930218ff0b4ddd10a6002239d9a454e29e107a7d06fefdfef0210feba044f9f29b1772c960dc29c00c7366c5cbc604240e665eb02a69372a7af979b26fbb78092ac7c4b88029a7c854513bc217bbfc7d90432e308eba15afc65aeb48ef100d5601e6afba257117a9");result["draft-12-256-3"]=testExpansion(12,"1ada31d5cf688221","c46ec1b18ce8a878725a37e780dfb7351f68ed2e194c79fbc6aebee1a667975d","1482072784bc6d06b4e73bdc118bc0103c7976786ca918e06986aa251f7e9cc1b2749a0a16ee83b4242d2e99b08d7c20092b80bc466c87283b61b1b39d0ffbabd94b116bc1ebdb329b9e4f620db695544a8e3d9b68473d0c975a46ad966ed631e42aff530ad5eac7d8047adfa1e5113c91f3e3b883f1d189ac1c8fe07ba5a42b");result["draft-20-256-1"]=testExpansion(20,"0000000000000000","0100000000000000000000000000000000000000000000000000000000000000","c5d30a7ce1ec119378c84f487d775a8542f13ece238a9455e8229e888de85bbd29eb63d0a17a5b999b52da22be4023eb07620a54f6fa6ad8737b71eb0464dac010f656e6d1fd55053e50c4875c9930a33f6d0263bd14dfd6ab8c70521c19338b2308b95cf8d0bb7d202d2102780ea3528f1cb48560f76b20f382b942500fceac");result["draft-20-256-2"]=testExpansion(20,"0100000000000000","0000000000000000000000000000000000000000000000000000000000000000","ef3fdfd6c61578fbf5cf35bd3dd33b8009631634d21e42ac33960bd138e50d32111e4caf237ee53ca8ad6426194a88545ddc497a0b466e7d6bbdb0041b2f586b5305e5e44aff19b235936144675efbe4409eb7e8e5f1430f5f5836aeb49bb5328b017c4b9dc11f8a03863fa803dc71d5726b2b6b31aa32708afe5af1d6b69058");result["draft-20-256-3"]=testExpansion(20,"1ada31d5cf688221","c46ec1b18ce8a878725a37e780dfb7351f68ed2e194c79fbc6aebee1a667975d","f63a89b75c2271f9368816542ba52f06ed49241792302b00b5e8f80ae9a473afc25b218f519af0fdd406362e8d69de7f54c604a6e00f353f110f771bdca8ab92e5fbc34e60a1d9a9db17345b0a402736853bf910b060bdf1f897b6290f01d138ae2c4c90225ba9ea14d518f55929dea098ca7a6ccfe61227053c84e49a4a3332");return result}function evalChaChaTest(v){for(var i in v){if(false==v[i]){return false}}return true}tool.set("test.chacha20",{exec:doChaChaTest,eval:evalChaChaTest})})(tool);(function(tool){var curve25519=tool.get("cipher.asymmetric.curve25519").constructor;function toBuf(hex){return tool.get("util.encoding")(hex,"hex").toArrayBuffer()}function toHEX(buf){return tool.get("util.encoding")(buf).toHEX()}function doCurve25519Test(){var buddy1=curve25519();var buddy1prvkey=toBuf("0000000000000000000000000000000000000000000000000000000000000003");buddy1.setPrivateKey(buddy1prvkey);var buddy1pubkey=buddy1.getPublicKey();var buddy1pub=curve25519();buddy1pub.setPublicKey(buddy1pubkey);console.log(toHEX(buddy1pubkey));var plaintext=toBuf("deadbeef");var buddy1ciphertext=buddy1pub.encrypt(plaintext);var decrypttext=buddy1.decrypt(buddy1ciphertext);console.log(toHEX(buddy1ciphertext));console.log(toHEX(decrypttext))}function evalCurve25519Test(){return true}tool.set("test.curve25519",{exec:doCurve25519Test,eval:evalCurve25519Test})})(tool);(function(tool){function getTests(){var tests={"iso-1":{input:new Uint8Array(0).buffer,result:"19FA61D75522A466 9B44E39C1D2E1726 C530232130D407F89AFEE0964997F7A7 3E83BE698B288FEB CF88E3E03C4F0757EA8964E59B63D937 08B138CC42A66EB3"},"iso-2":{input:tool.get("util.encoding")("a","ascii").toArrayBuffer(),result:"8ACA2602792AEC6F 11A67206531FB7D7 F0DFF59413145E6973C45001D0087B42 D11BC645413AEFF6 3A42391A39145A591A92200D560195E5 3B478584FDAE231A"},"iso-3":{input:tool.get("util.encoding")("abc","ascii").toArrayBuffer(),result:"4E2448A4C6F486BB 16B6562C73B4020B F3043E3A731BCE721AE1B303D97E6D4C 7181EEBDB6C57E27 7D0E34957114CBD6C797FC9D95D8B582 D225292076D4EEF5"},"iso-4":{input:tool.get("util.encoding")("message digest","ascii").toArrayBuffer(),result:"378C84A4126E2DC6 E56DCC7458377AAC 838D00032230F53CE1F5700C0FFB4D3B 8421557659EF55C1 06B4B52AC5A4AAA692ED920052838F33 62E86DBD37A8903E"},"iso-5":{input:tool.get("util.encoding")("abcdefghijklmnopqrstuvwxyz","ascii").toArrayBuffer(),result:"F1D754662636FFE9 2C82EBB9212A484A 8D38631EAD4238F5442EE13B8054E41B 08BF2A9251C30B6A 0B8AAE86177AB4A6F68F673E7207865D 5D9819A3DBA4EB3B"},"iso-6":{input:tool.get("util.encoding")("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789","ascii").toArrayBuffer(),result:"DC37E008CF9EE69B F11F00ED9ABA2690 1DD7C28CDEC066CC6AF42E40F82F3A1E 08EBA26629129D8F B7CB57211B9281A65517CC879D7B9621 42C65F5A7AF01467"},"iso-7":{input:tool.get("util.encoding")("12345678901234567890123456789012345678901234567890123456789012345678901234567890","ascii").toArrayBuffer(),result:"466EF18BABB0154D 25B9D38A6414F5C0 8784372BCCB204D6549C4AFADB601429 4D5BD8DF2A6C44E5 38CD047B2681A51A2C60481E88C5A20B 2C2A80CF3A9A083B"},"iso-8":{input:tool.get("util.encoding")("abcdbcdecdefdefgefghfghighijhijk","ascii").toArrayBuffer(),result:"2A987EA40F917061 F5D6F0A0E4644F48 8A7A5A52DEEE656207C562F988E95C69 16BDC8031BC5BE1B 7B947639FE050B56939BAAA0ADFF9AE6 745B7B181C3BE3FD"},"wiki-dog":{input:tool.get("util.encoding")("54686520717569636b2062726f776e20666f78206a756d7073206f76657220746865206c617a7920646f67","hex").toArrayBuffer(),result:"B97DE512E91E3828B40D2B0FDCE9CEB3C4A71F9BEA8D88E75C4FA854DF36725FD2B52EB6544EDCACD6F8BEDDFEA403CB55AE31F03AD62A5EF54E42EE82C3FB35"},"wiki-eog":{input:tool.get("util.encoding")("54686520717569636b2062726f776e20666f78206a756d7073206f76657220746865206c617a7920656f67","hex").toArrayBuffer(),result:"C27BA124205F72E6847F3E19834F925CC666D0974167AF915BB462420ED40CC50900D85A1F923219D832357750492D5C143011A76988344C2635E69D06F2D38C"}};return tests}function doHashTest(){var tests=getTests();var hashgen=tool.get("hash");var result={};for(var item in tests){var output=tests[item].result.replace(/[^0-9a-f]/gi,"");var hash=new hashgen().hash(tests[item]["input"]).hex;result[item]=Boolean(hash.toLowerCase()===output.toLowerCase())}return result}function evalHashTest(v){for(var i in v){if(false==v[i]){return false}}return true}tool.set("test.hash",{exec:doHashTest,eval:evalHashTest})})(tool);(function(tool){function doTest(){var items={hash:tool.get("test.hash"),salsa20:tool.get("test.salsa20"),chacha20:tool.get("test.chacha20"),curve25519:tool.get("test.curve25519")};var report={},evaluation={},conclusion=true;for(var itemName in items){report[itemName]=items[itemName].exec();evaluation[itemName]=items[itemName].eval(report[itemName]);if(conclusion){if(!evaluation[itemName]){conclusion=false}}}return{report:report,evaluation:evaluation,conclusion:conclusion}}tool.set("test",doTest);tool.exp("test",doTest)})(tool);(function(tool){var salsa20=tool.get("cipher.symmetric.salsa20").raw;var assureBuf=function(v){if(tool.get("util.type")(v).isArrayBuffer()){return v}return tool.get("util.encoding")(v,"hex").toArrayBuffer()};function testExpansion(rounds,nonceBuf,keyBuf,assertBuf){nonceBuf=assureBuf(nonceBuf);keyBuf=assureBuf(keyBuf);assertBuf=assureBuf(assertBuf);var nonceAry=new Uint8Array(nonceBuf);var keyAry=new Uint8Array(keyBuf);var input=new Uint8Array(8+keyAry.length);for(var i=0;i<8;i++){input[i]=nonceAry[i]}for(var i=0;i<keyAry.length;i++){input[i+8]=keyAry[i]}var cipher=new salsa20(rounds,true).key(input.buffer);if(nonceBuf.byteLength>8){var counterAry=new Uint32Array(nonceBuf.slice(8,16));cipher.seek(counterAry[0],counterAry[1])}var ret=cipher.encrypt(assertBuf);return tool.get("util.buffer").equal(ret,new Uint8Array(ret.byteLength).buffer)}function testCore(rounds,inputBuf,assertBuf){inputBuf=assureBuf(inputBuf);assertBuf=assureBuf(assertBuf);var cipher=new salsa20(rounds,true);var ret=cipher.core(inputBuf);return tool.get("util.buffer").equal(ret,assertBuf)}function doSalsaTest(){var result={};result["spec-core-1"]=testCore(10,new Uint8Array([211,159,13,115,76,55,82,183,3,117,222,37,191,187,234,136,49,237,179,48,1,106,178,219,175,199,166,48,86,16,179,207,31,240,32,63,15,83,93,161,116,147,48,113,238,55,204,36,79,201,235,79,3,81,156,47,203,26,244,243,88,118,104,54]).buffer,new Uint8Array([109,42,178,168,156,240,248,238,168,196,190,203,26,110,170,154,29,29,150,26,150,30,235,249,190,163,251,48,69,144,51,57,118,40,152,157,180,57,27,94,107,42,236,35,27,111,114,114,219,236,232,135,111,155,110,18,24,232,95,158,179,19,48,202]).buffer);result["spec-core-2"]=testCore(10,new Uint8Array([88,118,104,54,79,201,235,79,3,81,156,47,203,26,244,243,191,187,234,136,211,159,13,115,76,55,82,183,3,117,222,37,86,16,179,207,49,237,179,48,1,106,178,219,175,199,166,48,238,55,204,36,31,240,32,63,15,83,93,161,116,147,48,113]).buffer,new Uint8Array([179,19,48,202,219,236,232,135,111,155,110,18,24,232,95,158,26,110,170,154,109,42,178,168,156,240,248,238,168,196,190,203,69,144,51,57,29,29,150,26,150,30,235,249,190,163,251,48,27,111,114,114,118,40,152,157,180,57,27,94,107,42,236,35]).buffer);result["spec-exp-256"]=testExpansion(10,new Uint8Array([101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116]).buffer,new Uint8Array([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216]).buffer,new Uint8Array([69,37,68,39,41,15,107,193,255,139,122,6,170,233,217,98,89,144,182,106,21,51,200,65,239,49,222,34,215,114,40,126,104,197,7,225,197,153,31,2,102,78,76,176,84,245,246,184,177,160,133,130,6,72,149,119,192,195,132,236,234,103,246,74]).buffer);result["spec-exp-128"]=testExpansion(10,new Uint8Array([101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116]).buffer,new Uint8Array([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]).buffer,new Uint8Array([39,173,46,248,30,200,82,17,48,67,254,239,37,18,13,247,241,200,61,144,10,55,50,185,6,47,246,253,143,86,187,225,134,85,110,246,161,163,43,235,231,94,171,51,145,214,112,29,14,232,5,16,151,140,183,141,171,9,122,181,104,182,177,193]).buffer);result["aug-exp-256-1.0"]=testExpansion(10,"0000000000000000","8000000000000000000000000000000000000000000000000000000000000000","E3BE8FDD8BECA2E3EA8EF9475B29A6E7003951E1097A5C38D23B7A5FAD9F6844B22C97559E2723C7CBBD3FE4FC8D9A0744652A83E72A9C461876AF4D7EF1A117");result["aug-exp-256-2.252"]=testExpansion(10,"0000000000000000","FCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFC","356DD71DBC2B216B7A439E07BCC1348F769F7EF482486C92E8FD8EB050224838AB1F4DFCD2FB196AFD4C4FFBF51B91246BF45AE8131B8D5CAFA29FC3025A3597");result["aug-exp-256-6.0"]=testExpansion(10,"0D74DB42A91077DE","0053A6F94C9FF24598EB3E91E4378ADD3083D6297CCF2275C81B6EC11467BA0D","F5FAD53F79F9DF58C4AEA0D0ED9A9601F278112CA7180D565B420A48019670EAF24CE493A86263F677B46ACE1924773D2BB25571E1AA8593758FC382B1280B71");result["aug-exp-256-6.2"]=testExpansion(10,"1F86ED54BB2289F0","0A5DB00356A9FC4FA2F5489BEE4194E73A8DE03386D92C7FD22578CB1E71C417","3FE85D5BB1960A82480B5E6F4E965A4460D7A54501664F7D60B54B06100A37FFDCF6BDE5CE3F4886BA77DD5B44E95644E40A8AC65801155DB90F02522B644023");result["aug-exp-128-1.0"]=testExpansion(10,"0000000000000000","80000000000000000000000000000000","4DFA5E481DA23EA09A31022050859936DA52FCEE218005164F267CB65F5CFD7F2B4F97E0FF16924A52DF269515110A07F9E460BC65EF95DA58F740B7D1DBB0AA");result["aug-exp-128-1.18"]=testExpansion(10,"0000000000000000","00002000000000000000000000000000","BACFE4145E6D4182EA4A0F59D4076C7E83FFD17E7540E5B7DE70EEDDF9552006B291B214A43E127EED1DA1540F33716D83C3AD7D711CD03251B78B2568F2C844");result["aug-exp-128-2.18"]=testExpansion(10,"0000000000000000","12121212121212121212121212121212","05835754A1333770BBA8262F8A84D0FD70ABF58CDB83A54172B0C07B6CCA5641060E3097D2B19F82E918CB697D0F347DC7DAE05C14355D09B61B47298FE89AEB");result["aug-exp-128-6.2"]=testExpansion(10,"1F86ED54BB2289F0","0A5DB00356A9FC4FA2F5489BEE4194E7","8B354C8F8384D5591EA0FF23E7960472B494D04B2F787FC87B6569CB9021562FF5B1287A4D89FB316B69971E9B861A109CF9204572E3DE7EAB4991F4C7975427");result["aug-exp-256-1.0-multiple"]=testExpansion(10,"0000000000000000","8000000000000000000000000000000000000000000000000000000000000000","E3BE8FDD8BECA2E3EA8EF9475B29A6E7003951E1097A5C38D23B7A5FAD9F6844B22C97559E2723C7CBBD3FE4FC8D9A0744652A83E72A9C461876AF4D7EF1A1178da2b74eef1b6283e7e20166abcae538e9716e4669e2816b6b20c5c356802001cc1403a9a117d12a2669f456366d6ebb0f1246f1265150f793cdb4b253e348ae203d89bc025e802a7e0e00621d70aa36b7e07cb1e7d5b38d5e222b8b0e4b84070142b1e29504767d76824850320b5368129fdd74e861b498e3be8d16f2d7d16957BE81F47B17D9AE7C4FF15429A73E10ACF250ED3A90A93C711308A74C6216A9ED84CD126DA7F28E8ABF8BB63517E1CA98E712F4FB2E1A6AED9FDC73291FAA17958211C4BA2EBD5838C635EDB81F513A91A294E194F1C039AEEC657DCE40AA7E7C0AF57CACEFA40C9F14B71A4B3456A63E162EC7D8D10B8FFB1810D71001B618");return result}function evalSalsaTest(v){for(var i in v){if(false==v[i]){return false}}return true}tool.set("test.salsa20",{exec:doSalsaTest,eval:evalSalsaTest})})(tool);if("undefined"!=typeof module&&"undefined"!=module.exports){module.exports=exportTree}else{define([],function(){return exportTree})}return exportTree})();